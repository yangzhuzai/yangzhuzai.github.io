<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>0X009 StreamIO | 养猪日记</title>
<meta name=keywords content><meta name=description content="端口扫描






获取立足点
从端口开放情况来看，值得关注的端口有：80、389、443、445、3268、5985：
先看445和389，3268等：




那么突破口应该就在80或者443了：
简单看了一下首页，没有东西，目录扫描看看：


有注册和登录：


简单试了一下，好像没有万能密码，注册一个看看：


但是不让登录：


查看证书，发现域名好像不对：


访问这个网站：


好像也没有东西，再扫一下：


发现新内容：


疑似sql注入：
输入1‘&ndash;+


但是好像有拦截：
order by用不了，只能用select  挨个操作：
测了半天，发现是个sqlserver:


当前数据库名称为
STREAMIO


表名：


列名：


爆用户：


James ,Theodore ,Samantha ,Lauren ,William ,Sabrina ,Robert ,Thane ,Carmon ,Barry ,Oliver ,Michelle ,Gloria ,Victoria ,Alexendra ,Baxter ,Clara ,Barbra ,Lenord ,Austin ,Garfield ,Juliette ,Victor ,Lucifer ,Bruno ,Diablo ,Robin ,Stan ,yoshihide ,admin ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,aikun"><meta name=author content="养猪日记"><link rel=canonical href=https://yangzhuzai.github.io/posts/htb/0x009-streamio/><link crossorigin=anonymous href=/assets/css/stylesheet.54405a410796490bc874ab6181fac9b675753cc2b91375d8f882566459eca428.css integrity="sha256-VEBaQQeWSQvIdKthgfrJtnV1PMK5E3XY+IJWZFnspCg=" rel="preload stylesheet" as=style><link rel=icon href=https://yangzhuzai.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://yangzhuzai.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://yangzhuzai.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://yangzhuzai.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://yangzhuzai.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://yangzhuzai.github.io/posts/htb/0x009-streamio/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="0X009 StreamIO"><meta property="og:description" content="端口扫描






获取立足点
从端口开放情况来看，值得关注的端口有：80、389、443、445、3268、5985：
先看445和389，3268等：




那么突破口应该就在80或者443了：
简单看了一下首页，没有东西，目录扫描看看：


有注册和登录：


简单试了一下，好像没有万能密码，注册一个看看：


但是不让登录：


查看证书，发现域名好像不对：


访问这个网站：


好像也没有东西，再扫一下：


发现新内容：


疑似sql注入：
输入1‘&ndash;+


但是好像有拦截：
order by用不了，只能用select  挨个操作：
测了半天，发现是个sqlserver:


当前数据库名称为
STREAMIO


表名：


列名：


爆用户：


James ,Theodore ,Samantha ,Lauren ,William ,Sabrina ,Robert ,Thane ,Carmon ,Barry ,Oliver ,Michelle ,Gloria ,Victoria ,Alexendra ,Baxter ,Clara ,Barbra ,Lenord ,Austin ,Garfield ,Juliette ,Victor ,Lucifer ,Bruno ,Diablo ,Robin ,Stan ,yoshihide ,admin ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,aikun"><meta property="og:type" content="article"><meta property="og:url" content="https://yangzhuzai.github.io/posts/htb/0x009-streamio/"><meta property="og:image" content="https://yangzhuzai.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-10-11T14:25:59+08:00"><meta property="article:modified_time" content="2024-10-11T14:25:59+08:00"><meta property="og:site_name" content="养猪日记"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://yangzhuzai.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="0X009 StreamIO"><meta name=twitter:description content="端口扫描






获取立足点
从端口开放情况来看，值得关注的端口有：80、389、443、445、3268、5985：
先看445和389，3268等：




那么突破口应该就在80或者443了：
简单看了一下首页，没有东西，目录扫描看看：


有注册和登录：


简单试了一下，好像没有万能密码，注册一个看看：


但是不让登录：


查看证书，发现域名好像不对：


访问这个网站：


好像也没有东西，再扫一下：


发现新内容：


疑似sql注入：
输入1‘&ndash;+


但是好像有拦截：
order by用不了，只能用select  挨个操作：
测了半天，发现是个sqlserver:


当前数据库名称为
STREAMIO


表名：


列名：


爆用户：


James ,Theodore ,Samantha ,Lauren ,William ,Sabrina ,Robert ,Thane ,Carmon ,Barry ,Oliver ,Michelle ,Gloria ,Victoria ,Alexendra ,Baxter ,Clara ,Barbra ,Lenord ,Austin ,Garfield ,Juliette ,Victor ,Lucifer ,Bruno ,Diablo ,Robin ,Stan ,yoshihide ,admin ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,aikun"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://yangzhuzai.github.io/posts/"},{"@type":"ListItem","position":2,"name":"0X009 StreamIO","item":"https://yangzhuzai.github.io/posts/htb/0x009-streamio/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"0X009 StreamIO","name":"0X009 StreamIO","description":"端口扫描 获取立足点 从端口开放情况来看，值得关注的端口有：80、389、443、445、3268、5985：\n先看445和389，3268等：\n那么突破口应该就在80或者443了：\n简单看了一下首页，没有东西，目录扫描看看：\n有注册和登录：\n简单试了一下，好像没有万能密码，注册一个看看：\n但是不让登录：\n查看证书，发现域名好像不对：\n访问这个网站：\n好像也没有东西，再扫一下：\n发现新内容：\n疑似sql注入：\n输入1‘\u0026ndash;+\n但是好像有拦截：\norder by用不了，只能用select 挨个操作：\n测了半天，发现是个sqlserver:\n当前数据库名称为\nSTREAMIO\n表名：\n列名：\n爆用户：\nJames ,Theodore ,Samantha ,Lauren ,William ,Sabrina ,Robert ,Thane ,Carmon ,Barry ,Oliver ,Michelle ,Gloria ,Victoria ,Alexendra ,Baxter ,Clara ,Barbra ,Lenord ,Austin ,Garfield ,Juliette ,Victor ,Lucifer ,Bruno ,Diablo ,Robin ,Stan ,yoshihide ,admin ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,aikun\n","keywords":[],"articleBody":"端口扫描 获取立足点 从端口开放情况来看，值得关注的端口有：80、389、443、445、3268、5985：\n先看445和389，3268等：\n那么突破口应该就在80或者443了：\n简单看了一下首页，没有东西，目录扫描看看：\n有注册和登录：\n简单试了一下，好像没有万能密码，注册一个看看：\n但是不让登录：\n查看证书，发现域名好像不对：\n访问这个网站：\n好像也没有东西，再扫一下：\n发现新内容：\n疑似sql注入：\n输入1‘–+\n但是好像有拦截：\norder by用不了，只能用select 挨个操作：\n测了半天，发现是个sqlserver:\n当前数据库名称为\nSTREAMIO\n表名：\n列名：\n爆用户：\nJames ,Theodore ,Samantha ,Lauren ,William ,Sabrina ,Robert ,Thane ,Carmon ,Barry ,Oliver ,Michelle ,Gloria ,Victoria ,Alexendra ,Baxter ,Clara ,Barbra ,Lenord ,Austin ,Garfield ,Juliette ,Victor ,Lucifer ,Bruno ,Diablo ,Robin ,Stan ,yoshihide ,admin ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,aikun\n爆密码：\n现在拿到账户密码了，然后看看这个密码是什么格式：\n看样子是md5：\n从现在拿到的账号密码来看，最简单的方式是直接登录winrm:\n但是好像失败了：\n那么就只能继续回去web看看了：\n这里的内容需要爆破，但是这里不追求速度，就直接用burp了：\n进来后确实没想到这里会有需要fuzz的地方，是这个参数：\n通过FUZZ可以发现debug这个参数：\n但是这里我没有怀疑过这个地方的使用方式，（因为写了只有管理员才可用，但是实际上这个用户就可以用了）\n应该给一个index.php的参数给他，就可以发现有报错，其实就是文件包含了：\n那么这里其实是想要读取文件，但是读取失败了，用为协议，然后base64带出来：\n就会发现这个东西：\n数据库的密码：\n(“Database”=\u003e“STREAMIO”, “UID” =\u003e “db_admin”, “PWD” =\u003e ‘B1@hx31234567890’);\n但是这个数据库密码有什么用呢，数据库不对外开放，sql注入也不允许切换用户，\n可以发现master.php\n文件包含读取：\n发现里面的内容：这里需要简单看一下代码，核心是这句：\neval(file_get_contents($_POST[‘include’]));，使用post传参，会包含include的文件，然后执行里面的内容：\n上传NC，反弹shell：\n这里别用start /b会出现bug:\n然后就是之前的数据库账号密码的用处了：\nsqlcmd -S ‘(local)’ -U db_admin -P ‘B1@hx31234567890’ -Q ‘USE STREAMIO_BACKUP; select username,password from users;’\n再次破解：\n用户不多，挨个看看权限即可：\n远程登录：\n提权 bloodhound bloodhound的分析结果大致意思为，需要本地提权，除非拿到MARTIN、JDGODD的用户权限：\n然后是winpeass的分析结果：\n注意这个firefox：\n然后去github上找了一个这个项目：\nhttps://github.com/AlessandroZ/LaZagne\n这里拿到了我们的目标用户权限，JDGODD，用这个用户可以根据bloodhound提权到domain admin，注意，上面显示的密码有误，可多尝试几次就可以了：\n[+] Password found !!!\nURL: https://slack.streamio.htb\nLogin: JDgodd\nPassword: JDg0dd1s@d0p3cr3@t0r\n这个用户没有远程管理权限，可能得域外打\n先拿到CORE STAFF组权限：\n修改所有者：\npython owneredit.py -action write -new-owner ‘JDgodd’ -target ‘CORE STAFF’ ‘STREAMIO.HTB’/‘JDgodd’:‘JDg0dd1s@d0p3cr3@t0r’\n修改DACL权限，以便于读取密码：\n授予JDgodd向CORE STAFF组添加用户的权限：\ndacledit.py -action ‘write’ -rights ‘WriteMembers’ -principal ‘JDgodd’ -target-dn ‘CN=CORE STAFF,CN=USERS,DC=STREAMIO,DC=HTB’ ‘STREAMIO.HTB’/‘JDgodd’:‘JDg0dd1s@d0p3cr3@t0r’\n把自己添加到CORE STAFF组内：\nnet rpc group addmem “CORE STAFF” “JDgodd” -U “STREAMIO.HTB”/“JDgodd”%“JDg0dd1s@d0p3cr3@t0r” -S “dc.STREAMIO.HTB”\n再次查看权限：\n读取密码：\n登录：\n总结 这台靶机的难点在于获取立足点较为曲折，简单梳理一下：\nweb：\n1、首先是注册用户，添加域名，需要反复查看证书是否变化，域名有两个，第一次卡住，没发现域名变化。\n2、使用新域名，再次目录扫描，发现查找页面，sql注入，是个sqlserver手动注入，需要熟悉。\n3、由于是通过websql注入获取的账户密码，通过获取到的账户密码，进行web爆破，获取到一个合法用户，这里的手动登录有问题，不会弹出错误，也不清楚是不是系统存在bug，所以遇到这种情况还是尽量使用工具爆破一波再说。\n4、登录后没有变化，但是可以进去之前403的admin目录，注意页面功能的？后面的参数可以fuzz，第二次卡住。\n5、fuzz发现debug，参数给index.php发现有反应，是个文件包含，需要配合伪协议base64导出，发现数据库账号密码，但是没有连接条件。\n6、第三次卡住，需要再次目录扫描admin目录，发现master.php文件，通过文件包含可以读取源码。\n7、代码审计，发现include参数可以包含执行php代码，通过debug文件包含+post传参+远程文件包含，成功拿到shell，这里面细节很多，多次导致web访问崩掉，要么重启，要么等很长时间。\n提权\n8、使用拿到的高权限数据库账密，再次查询sqlserver，发现USE STREAMIO_BACKUP数据库，疑似备份数据库，发现新账户密码。\n9、再次破解后，经过尝试，终于获取到域内用户身份，登录winrm。\n10、bloodhound成功告诉我们提权路径，但是目前身份欠缺，需要寻找立足点。\n11、通过winpeass发现疑似firefox的账号密码信息，通过LaZagne项目，成功读取，但是密码乱序，需要爆破。\n12、通过尝试，成功拿到了JDgodd用户身份，该身份是bloodhound提示的可提权身份之一。\n13、通过JDgodd的writeowner权限，成功获取了CORE STAFF组的owner，owner拥有writedacl权限。\n14、通过向CORE STAFF组添加自己的身份，成功进入该组。\n15、CORE STAFF组拥有ldap的密码读取权限，成功读取dc的密码\n16、登录dc，administrator\n","wordCount":"200","inLanguage":"en","image":"https://yangzhuzai.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-10-11T14:25:59+08:00","dateModified":"2024-10-11T14:25:59+08:00","author":{"@type":"Person","name":"养猪日记"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://yangzhuzai.github.io/posts/htb/0x009-streamio/"},"publisher":{"@type":"Organization","name":"养猪日记","logo":{"@type":"ImageObject","url":"https://yangzhuzai.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://yangzhuzai.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://yangzhuzai.github.io/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://yangzhuzai.github.io/categories/ title=分类><span>分类</span></a></li><li><a href=https://yangzhuzai.github.io/search/ title=搜索><span>搜索</span></a></li><li><a href=https://github.com/yangzhuzai title=Github><span>Github</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://yangzhuzai.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://yangzhuzai.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">0X009 StreamIO</h1><div class=post-meta><span title='2024-10-11 14:25:59 +0800 CST'>October 11, 2024</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;200 words&nbsp;·&nbsp;养猪日记</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><ul><li><a href=#bloodhound>bloodhound</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h1 id=端口扫描>端口扫描<a hidden class=anchor aria-hidden=true href=#端口扫描>#</a></h1><p><img loading=lazy src=/htb_img/WEBRESOURCE3257329be177fe9aef7e4aaf52293d27image.png alt></p><p><img loading=lazy src=/htb_img/WEBRESOURCEd3c1b4b24bc3595c19b76fd9c7a427e1image.png alt></p><p><img loading=lazy src=/htb_img/WEBRESOURCEbad7ae63e95fb7c7ab832c90dcb3c920image.png alt></p><h1 id=获取立足点>获取立足点<a hidden class=anchor aria-hidden=true href=#获取立足点>#</a></h1><p>从端口开放情况来看，值得关注的端口有：80、389、443、445、3268、5985：</p><p>先看445和389，3268等：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE4a281f5b3be9d6918b712cc983ca01fdimage.png alt></p><p><img loading=lazy src=/htb_img/WEBRESOURCEf3f130c2816498be203fa0fb14fd62aaimage.png alt></p><p>那么突破口应该就在80或者443了：</p><p>简单看了一下首页，没有东西，目录扫描看看：</p><p><img loading=lazy src=/htb_img/WEBRESOURCEd0d40e50c454fdb84b6ec6ec134d9a84image.png alt></p><p>有注册和登录：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE17ea2ef4df506d9f2b6d590de8e8896fimage.png alt></p><p>简单试了一下，好像没有万能密码，注册一个看看：</p><p><img loading=lazy src=/htb_img/WEBRESOURCEdfe5603f94b28380e2893807f702875aimage.png alt></p><p>但是不让登录：</p><p><img loading=lazy src=/htb_img/WEBRESOURCEbb1872229a80d5870f7a8b2c0ee61cadimage.png alt></p><p>查看证书，发现域名好像不对：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE24fe63e5dd0fbbb8607cad6090bceda5image.png alt></p><p>访问这个网站：</p><p><img loading=lazy src=/htb_img/WEBRESOURCEf16ac18a8c8ec5e36e6e9823fed7ce1aimage.png alt></p><p>好像也没有东西，再扫一下：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE6e2747aa5f9e5ed0c57c279d3ecfb9ffimage.png alt></p><p>发现新内容：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE94b59761b65a13c2d34f8d708f1ce12dimage.png alt></p><p>疑似sql注入：</p><p>输入1‘&ndash;+</p><p><img loading=lazy src=/htb_img/WEBRESOURCE3f154c70c42d264e0354e08271598deeimage.png alt></p><p>但是好像有拦截：</p><p>order by用不了，只能用select 挨个操作：</p><p>测了半天，发现是个sqlserver:</p><p><img loading=lazy src=/htb_img/WEBRESOURCEd3526c4ab1b930e13333a6ba8fcc7230image.png alt></p><p>当前数据库名称为</p><p>STREAMIO</p><p><img loading=lazy src=/htb_img/WEBRESOURCE8e2af23e6e1232cf3c8c74ca9c6d6549image.png alt></p><p>表名：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE092d98297cb3dcdf9425e1f52fd32d62image.png alt></p><p>列名：</p><p><img loading=lazy src=/htb_img/WEBRESOURCEf06a3da5fc6fa9f6c7592d1700052202image.png alt></p><p>爆用户：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE73d4eb15471bc65d5caa1927142b8ce7image.png alt></p><p>James ,Theodore ,Samantha ,Lauren ,William ,Sabrina ,Robert ,Thane ,Carmon ,Barry ,Oliver ,Michelle ,Gloria ,Victoria ,Alexendra ,Baxter ,Clara ,Barbra ,Lenord ,Austin ,Garfield ,Juliette ,Victor ,Lucifer ,Bruno ,Diablo ,Robin ,Stan ,yoshihide ,admin ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,cxk ,aikun</p><p>爆密码：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE16d052e8cda4f27ae34c2f651be88c96image.png alt></p><p>现在拿到账户密码了，然后看看这个密码是什么格式：</p><p>看样子是md5：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE915c3f9a2cd79f574aa6bb34daa56feaimage.png alt></p><p>从现在拿到的账号密码来看，最简单的方式是直接登录winrm:</p><p>但是好像失败了：</p><p><img loading=lazy src=/htb_img/WEBRESOURCEe695ceda3036d8a7f1f10e59ae9ccc3bimage.png alt></p><p>那么就只能继续回去web看看了：</p><p>这里的内容需要爆破，但是这里不追求速度，就直接用burp了：</p><p><img loading=lazy src=/htb_img/WEBRESOURCEe2e64f9ce67a37872fe6093fe5309455image.png alt></p><p>进来后确实没想到这里会有需要fuzz的地方，是这个参数：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE9daeb97208c2549be4829ab5c0f227ddimage.png alt></p><p>通过FUZZ可以发现debug这个参数：</p><p><img loading=lazy src=/htb_img/WEBRESOURCEc4c7b97d65f371bfa523aecd9f20e099image.png alt></p><p>但是这里我没有怀疑过这个地方的使用方式，（因为写了只有管理员才可用，但是实际上这个用户就可以用了）</p><p>应该给一个index.php的参数给他，就可以发现有报错，其实就是文件包含了：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE4a88ca2830c5bfbe460f158057ccfa0eimage.png alt></p><p>那么这里其实是想要读取文件，但是读取失败了，用为协议，然后base64带出来：</p><p><img loading=lazy src=/htb_img/WEBRESOURCEf5ecbc92f55f32a79c53a4d3b47e36e0image.png alt></p><p>就会发现这个东西：</p><p>数据库的密码：</p><p>(&ldquo;Database&rdquo;=>&ldquo;STREAMIO&rdquo;, &ldquo;UID&rdquo; => &ldquo;db_admin&rdquo;, &ldquo;PWD&rdquo; => &lsquo;B1@hx31234567890&rsquo;);</p><p><img loading=lazy src=/htb_img/WEBRESOURCE649ed1645b57ea105400ff181daf7713image.png alt></p><p>但是这个数据库密码有什么用呢，数据库不对外开放，sql注入也不允许切换用户，</p><p>可以发现master.php</p><p><img loading=lazy src=/htb_img/WEBRESOURCE60d7652cac85e7d7475af0df0d6e5a67image.png alt></p><p>文件包含读取：</p><p>发现里面的内容：这里需要简单看一下代码，核心是这句：</p><p>eval(file_get_contents($_POST[&lsquo;include&rsquo;]));，使用post传参，会包含include的文件，然后执行里面的内容：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE056583c599f903abcabacbb3efbfe5edimage.png alt></p><p>上传NC，反弹shell：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE70791017a5a84e8a41f89af2256740feimage.png alt></p><p>这里别用start /b会出现bug:</p><p><img loading=lazy src=/htb_img/WEBRESOURCE2999dc72307c0606ea6a2b9b103a8bd0image.png alt></p><p>然后就是之前的数据库账号密码的用处了：</p><p>sqlcmd -S &lsquo;(local)&rsquo; -U db_admin -P &lsquo;B1@hx31234567890&rsquo; -Q &lsquo;USE STREAMIO_BACKUP; select username,password from users;&rsquo;</p><p><img loading=lazy src=/htb_img/WEBRESOURCEcdd5cc6a5f8da1c4ee85397602d0e37dimage.png alt></p><p>再次破解：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE2e9b34263148a4a1ec4f95eeb970fc14image.png alt></p><p><img loading=lazy src=/htb_img/WEBRESOURCEbaf6f2415f3ff8274d7d3b02eed4bf25image.png alt></p><p>用户不多，挨个看看权限即可：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE43ac71d4f60a1f624f2abe7730c95550image.png alt></p><p>远程登录：</p><p><img loading=lazy src=/htb_img/WEBRESOURCEf6efd6d67150ee89528154a08f44adecimage.png alt></p><h1 id=提权>提权<a hidden class=anchor aria-hidden=true href=#提权>#</a></h1><h3 id=bloodhound>bloodhound<a hidden class=anchor aria-hidden=true href=#bloodhound>#</a></h3><p>bloodhound的分析结果大致意思为，需要本地提权，除非拿到MARTIN、JDGODD的用户权限：</p><p><img loading=lazy src=/htb_img/WEBRESOURCEc55a9afea116da26f133e194262e641aimage.png alt></p><p>然后是winpeass的分析结果：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE414b4aff5cfc4f3fc612bf453b99529cimage.png alt></p><p>注意这个firefox：</p><p>然后去github上找了一个这个项目：</p><p><a href=https://github.com/AlessandroZ/LaZagne>https://github.com/AlessandroZ/LaZagne</a></p><p><img loading=lazy src=/htb_img/WEBRESOURCE172fcb1222093a887b1ffe28133dcda1image.png alt></p><p>这里拿到了我们的目标用户权限，JDGODD，用这个用户可以根据bloodhound提权到domain admin，注意，上面显示的密码有误，可多尝试几次就可以了：</p><p>[+] Password found !!!</p><p>URL: <a href=https://slack.streamio.htb>https://slack.streamio.htb</a></p><p>Login: JDgodd</p><p>Password: JDg0dd1s@d0p3cr3@t0r</p><p>这个用户没有远程管理权限，可能得域外打</p><p><img loading=lazy src=/htb_img/WEBRESOURCE2bdfac7bea4a8c2947ad730be848d373image.png alt></p><p>先拿到CORE STAFF组权限：</p><p>修改所有者：</p><p>python owneredit.py -action write -new-owner &lsquo;JDgodd&rsquo; -target &lsquo;CORE STAFF&rsquo; &lsquo;STREAMIO.HTB&rsquo;/&lsquo;JDgodd&rsquo;:&lsquo;JDg0dd1s@d0p3cr3@t0r&rsquo;</p><p><img loading=lazy src=/htb_img/WEBRESOURCE4eac49f935eb4e0e5f0c41f797a9aa2aimage.png alt></p><p>修改DACL权限，以便于读取密码：</p><p>授予JDgodd向CORE STAFF组添加用户的权限：</p><p>dacledit.py -action &lsquo;write&rsquo; -rights &lsquo;WriteMembers&rsquo; -principal &lsquo;JDgodd&rsquo; -target-dn &lsquo;CN=CORE STAFF,CN=USERS,DC=STREAMIO,DC=HTB&rsquo; &lsquo;STREAMIO.HTB&rsquo;/&lsquo;JDgodd&rsquo;:&lsquo;JDg0dd1s@d0p3cr3@t0r&rsquo;</p><p><img loading=lazy src=/htb_img/WEBRESOURCE8819df6fcb6f6386216581c065c9ef59image.png alt></p><p>把自己添加到CORE STAFF组内：</p><p>net rpc group addmem &ldquo;CORE STAFF&rdquo; &ldquo;JDgodd&rdquo; -U &ldquo;STREAMIO.HTB&rdquo;/&ldquo;JDgodd&rdquo;%&ldquo;JDg0dd1s@d0p3cr3@t0r&rdquo; -S &ldquo;dc.STREAMIO.HTB&rdquo;</p><p><img loading=lazy src=/htb_img/WEBRESOURCE772010643d40cc7b821083c458e09fc1image.png alt></p><p>再次查看权限：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE03f1c7d3ca316a89b42bc634c661dc16image.png alt></p><p>读取密码：</p><p><img loading=lazy src=/htb_img/WEBRESOURCEabb6041f94fd326c8331254cc9829084image.png alt></p><p>登录：</p><p><img loading=lazy src=/htb_img/WEBRESOURCE3df148660b982264a76982c9c32a6b94image.png alt></p><h1 id=总结>总结<a hidden class=anchor aria-hidden=true href=#总结>#</a></h1><p>这台靶机的难点在于获取立足点较为曲折，简单梳理一下：</p><p>web：</p><p>1、首先是注册用户，添加域名，需要反复查看证书是否变化，域名有两个，第一次卡住，没发现域名变化。</p><p>2、使用新域名，再次目录扫描，发现查找页面，sql注入，是个sqlserver手动注入，需要熟悉。</p><p>3、由于是通过websql注入获取的账户密码，通过获取到的账户密码，进行web爆破，获取到一个合法用户，这里的手动登录有问题，不会弹出错误，也不清楚是不是系统存在bug，所以遇到这种情况还是尽量使用工具爆破一波再说。</p><p>4、登录后没有变化，但是可以进去之前403的admin目录，注意页面功能的？后面的参数可以fuzz，第二次卡住。</p><p>5、fuzz发现debug，参数给index.php发现有反应，是个文件包含，需要配合伪协议base64导出，发现数据库账号密码，但是没有连接条件。</p><p>6、第三次卡住，需要再次目录扫描admin目录，发现master.php文件，通过文件包含可以读取源码。</p><p>7、代码审计，发现include参数可以包含执行php代码，通过debug文件包含+post传参+远程文件包含，成功拿到shell，这里面细节很多，多次导致web访问崩掉，要么重启，要么等很长时间。</p><p>提权</p><p>8、使用拿到的高权限数据库账密，再次查询sqlserver，发现USE STREAMIO_BACKUP数据库，疑似备份数据库，发现新账户密码。</p><p>9、再次破解后，经过尝试，终于获取到域内用户身份，登录winrm。</p><p>10、bloodhound成功告诉我们提权路径，但是目前身份欠缺，需要寻找立足点。</p><p>11、通过winpeass发现疑似firefox的账号密码信息，通过LaZagne项目，成功读取，但是密码乱序，需要爆破。</p><p>12、通过尝试，成功拿到了JDgodd用户身份，该身份是bloodhound提示的可提权身份之一。</p><p>13、通过JDgodd的writeowner权限，成功获取了CORE STAFF组的owner，owner拥有writedacl权限。</p><p>14、通过向CORE STAFF组添加自己的身份，成功进入该组。</p><p>15、CORE STAFF组拥有ldap的密码读取权限，成功读取dc的密码</p><p>16、登录dc，administrator</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://yangzhuzai.github.io/posts/vulnhub/0x009-me-and-my-girlfriend-1/><span class=title>« Prev</span><br><span>0x009 Me and My Girlfriend 1</span>
</a><a class=next href=https://yangzhuzai.github.io/posts/vulnhub/0x010-my-file-server-1/><span class=title>Next »</span><br><span>0x010 My File Server 1</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://yangzhuzai.github.io/>养猪日记</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>